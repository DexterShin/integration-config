# YAML structure to define email recipients aliases
- notification-emails:
    name: listofemails  # a 'name' is required by JJB.
    lists:
     - CirrusSearch: &emails-CirrusSearch
        cmcmahon@wikimedia.org neverett@wikimedia.org qa-alerts@lists.wikimedia.org

     - Growth: &emails-growth
        mflaschen@wikimedia.org qa-alerts@lists.wikimedia.org rmoen@wikimedia.org samsmith@wikimedia.org

     - i18n: &emails-i18n
        aaharoni@wikimedia.org cmcmahon@wikimedia.org qa-alerts@lists.wikimedia.org

     - MultimediaViewer: &emails-multimedia
        multimedia-alerts@lists.wikimedia.org qa-alerts@lists.wikimedia.org

     - qa: &emails-qa
        cmcmahon@wikimedia.org qa-alerts@lists.wikimedia.org

     - qa: &emails-qa-alerts
        qa-alerts@lists.wikimedia.org

     - ULS: &emails-ULS
        aaharoni@wikimedia.org cmcmahon@wikimedia.org kmistry@wikimedia.org qa-alerts@lists.wikimedia.org

     - UploadWizard: &emails-UploadWizard
        qa-alerts@lists.wikimedia.org cmcmahon@wikimedia.org neilk@neilk.net

     - VisualEditor: &emails-VisualEditor
        cmcmahon@wikimedia.org jforrester@wikimedia.org qa-alerts@lists.wikimedia.org

# CirrusSearch
- project:
    name: CirrusSearch
    browser: firefox
    folder: tests
    headless: 'false'
    mediawiki_user: Selenium_user
    platform: linux
    recipients: *emails-CirrusSearch
    repository: mediawiki/extensions/CirrusSearch

    jobs:
     - 'browsertests-{name}-{mediawiki_url}-{platform}-{browser}-sauce':
        mediawiki_password_variable: MEDIAWIKI_PASSWORD_SELENIUM_USER_WMFLABS_ORG
        mediawiki_url: en.wikipedia.beta.wmflabs.org

     - 'browsertests-{name}-{mediawiki_url}-{platform}-{browser}-sauce':
        mediawiki_password_variable: MEDIAWIKI_PASSWORD_SELENIUM_USER_WIKIPEDIA_ORG
        mediawiki_url: test2.wikipedia.org

# ContentTranslation
- project:
    name: ContentTranslation
    browser: firefox
    folder: tests
    headless: 'false'
    mediawiki_password_variable: MEDIAWIKI_PASSWORD_SELENIUM_USER_WMFLABS_ORG
    mediawiki_url: language-stage.wmflabs.org
    mediawiki_user: Selenium_user
    platform: linux
    repository: mediawiki/extensions/ContentTranslation

    # Restrict email notifications since language-stage is broken
    #recipients: *emails-ULS
    recipients: *emails-qa-alerts

    jobs:
     - 'browsertests-{name}-{mediawiki_url}-{platform}-{browser}-sauce'

# Core
- project:
    name: Core
    browser: firefox
    folder: tests
    headless: 'false'
    mediawiki_password_variable: MEDIAWIKI_PASSWORD_SELENIUM_USER_WMFLABS_ORG
    mediawiki_url: en.wikipedia.beta.wmflabs.org
    mediawiki_user: Selenium_user
    platform: linux
    recipients: *emails-qa
    repository: mediawiki/core

    jobs:
     - 'browsertests-{name}-{mediawiki_url}-{platform}-{browser}-sauce'

# Echo
- project:
    name: Echo
    folder: tests
    headless: 'false'
    mediawiki_user: Selenium_user
    platform: linux
    recipients: *emails-qa
    repository: mediawiki/extensions/Echo

    jobs:
     - 'browsertests-{name}-{mediawiki_url}-{platform}-{browser}-sauce':
        browser: chrome
        mediawiki_url: en.wikipedia.beta.wmflabs.org
        mediawiki_password_variable: MEDIAWIKI_PASSWORD_SELENIUM_USER_WMFLABS_ORG

     - 'browsertests-{name}-{mediawiki_url}-{platform}-{browser}-sauce':
        browser: firefox
        mediawiki_url: en.wikipedia.beta.wmflabs.org
        mediawiki_password_variable: MEDIAWIKI_PASSWORD_SELENIUM_USER_WMFLABS_ORG

     - 'browsertests-{name}-{mediawiki_url}-{platform}-{browser}-sauce':
        browser: chrome
        mediawiki_url: test2.wikipedia.org
        mediawiki_password_variable: MEDIAWIKI_PASSWORD_SELENIUM_USER_WIKIPEDIA_ORG

     - 'browsertests-{name}-{mediawiki_url}-{platform}-{browser}-sauce':
        browser: firefox
        mediawiki_url: test2.wikipedia.org
        mediawiki_password_variable: MEDIAWIKI_PASSWORD_SELENIUM_USER_WIKIPEDIA_ORG

# Flow
- project:
    name: Flow
    folder: tests
    headless: 'false'
    mediawiki_user: Selenium_user
    platform: linux
    recipients: *emails-qa
    repository: mediawiki/extensions/Flow

    jobs:
     - 'browsertests-{name}-{mediawiki_url}-{platform}-{browser}-sauce':
        browser: chrome
        mediawiki_password_variable: MEDIAWIKI_PASSWORD_SELENIUM_USER_WMFLABS_ORG
        mediawiki_url: en.wikipedia.beta.wmflabs.org

     - 'browsertests-{name}-{mediawiki_url}-{platform}-{browser}-sauce':
        browser: firefox
        mediawiki_password_variable: MEDIAWIKI_PASSWORD_SELENIUM_USER_WMFLABS_ORG
        mediawiki_url: en.wikipedia.beta.wmflabs.org

     - 'browsertests-{name}-{mediawiki_url}-{platform}-{browser}-sauce':
        browser: internet_explorer
        mediawiki_password_variable: MEDIAWIKI_PASSWORD_SELENIUM_USER_WMFLABS_ORG
        mediawiki_url: en.wikipedia.beta.wmflabs.org
        platform: 'windows_8'

     - 'browsertests-{name}-{mediawiki_url}-{platform}-{browser}-sauce':
        browser: chrome
        mediawiki_password_variable: MEDIAWIKI_PASSWORD_SELENIUM_USER_WIKIPEDIA_ORG
        mediawiki_url: test2.wikipedia.org

     - 'browsertests-{name}-{mediawiki_url}-{platform}-{browser}-sauce':
        browser: firefox
        mediawiki_password_variable: MEDIAWIKI_PASSWORD_SELENIUM_USER_WIKIPEDIA_ORG
        mediawiki_url: test2.wikipedia.org

     - 'browsertests-{name}-{mediawiki_url}-{platform}-{browser}-sauce':
        browser: internet_explorer
        platform: 'windows_8'
        mediawiki_password_variable: MEDIAWIKI_PASSWORD_SELENIUM_USER_WIKIPEDIA_ORG
        mediawiki_url: test2.wikipedia.org

     - 'browsertests-{name}-{mediawiki_url}-{platform}-{browser}-monobook-sauce':
        browser: chrome
        mediawiki_password_variable: MEDIAWIKI_PASSWORD_SELENIUM_USER_WMFLABS_ORG
        mediawiki_url: en.wikipedia.beta.wmflabs.org
        mediawiki_user: Selenium_user_monobook

     - 'browsertests-{name}-{mediawiki_url}-{platform}-{browser}-monobook-sauce':
        browser: firefox
        mediawiki_password_variable: MEDIAWIKI_PASSWORD_SELENIUM_USER_WMFLABS_ORG
        mediawiki_url: en.wikipedia.beta.wmflabs.org
        mediawiki_user: Selenium_user_monobook




# Math
- project:
    name: Math
    folder: tests
    headless: 'false'
    mediawiki_password_variable: MEDIAWIKI_PASSWORD_SELENIUM_USER_WMFLABS_ORG
    mediawiki_url: en.wikipedia.beta.wmflabs.org
    mediawiki_user: Selenium_user
    platform: linux
    recipients: *emails-qa
    repository: mediawiki/extensions/Math

    jobs:
     - 'browsertests-{name}-{mediawiki_url}-{platform}-{browser}-sauce':
        browser: chrome

     - 'browsertests-{name}-{mediawiki_url}-{platform}-{browser}-sauce':
        browser: firefox

# GettingStarted
- project:
    name: GettingStarted
    browser: firefox
    folder: tests
    headless: 'false'
    mediawiki_password_variable: MEDIAWIKI_PASSWORD_SELENIUM_USER_WMFLABS_ORG
    mediawiki_url: en.wikipedia.beta.wmflabs.org
    mediawiki_user: Selenium_user
    platform: linux
    recipients: *emails-growth
    repository: mediawiki/extensions/GettingStarted

    jobs:
     - 'browsertests-{name}-{mediawiki_url}-{platform}-{browser}-sauce'

# MobileFrontend
- project:
    name: MobileFrontend
    folder: tests
    headless: 'false'
    mediawiki_password_variable: MEDIAWIKI_PASSWORD_SELENIUM_USER_WMFLABS_ORG
    mediawiki_url: en.m.wikipedia.beta.wmflabs.org
    mediawiki_user: Selenium_user
    platform: linux
    recipients: *emails-qa
    repository: mediawiki/extensions/MobileFrontend

    jobs:
     - 'browsertests-{name}-{mediawiki_url}-{platform}-{browser}-sauce':
        browser: chrome

     - 'browsertests-{name}-{mediawiki_url}-{platform}-{browser}-sauce':
        browser: firefox

     - 'browsertests-{name}-{mediawiki_url}-{platform}-{browser}-sauce':
        browser: firefox
        mediawiki_password_variable: MEDIAWIKI_PASSWORD_SELENIUM_USER_WIKIPEDIA_ORG
        mediawiki_url: test2.m.wikipedia.org

# MultimediaViewer
- project:
    name: MultimediaViewer
    browser: firefox
    folder: tests
    headless: 'false'
    mediawiki_password_variable: MEDIAWIKI_PASSWORD_SELENIUM_USER_WMFLABS_ORG
    mediawiki_url: en.wikipedia.beta.wmflabs.org
    mediawiki_user: Selenium_user
    platform: linux
    recipients: *emails-multimedia
    repository: mediawiki/extensions/MultimediaViewer

    jobs:
     - 'browsertests-{name}-{mediawiki_url}-{platform}-{browser}-sauce':
        browser: chrome

     - 'browsertests-{name}-{mediawiki_url}-{platform}-{browser}-sauce':
        browser: firefox

     - 'browsertests-{name}-{mediawiki_url}-{platform}-{browser}-{version}-sauce':
        browser: internet_explorer
        platform: 'windows_7'
        version: '8'
        # MultimediaViewer is known to be broken under IE 8.0. Restrict email
        # notifications while it is being worked on.
        # Bug 70932
        recipients: *emails-qa-alerts

     - 'browsertests-{name}-{mediawiki_url}-{platform}-{browser}-{version}-sauce':
        browser: internet_explorer
        platform: 'windows_7'
        version: '9'

     - 'browsertests-{name}-{mediawiki_url}-{platform}-{browser}-sauce':
        browser: internet_explorer
        platform: 'windows_8'

     - 'browsertests-{name}-{mediawiki_url}-{platform}-{browser}-{version}-sauce':
        browser: internet_explorer
        platform: 'windows_8.1'
        version: '11'

     - 'browsertests-{name}-{mediawiki_url}-{platform}-{browser}-sauce':
        browser: safari
        platform: 'os_x_10.9'

     - 'browsertests-{name}-{mediawiki_url}-{platform}-{browser}-sauce':
        browser: firefox
        mediawiki_password_variable: MEDIAWIKI_PASSWORD_SELENIUM_USER_WIKIPEDIA_ORG
        mediawiki_url: mediawiki.org

# PageTriage
- project:
    name: PageTriage
    folder: tests
    headless: 'false'
    mediawiki_password_variable: MEDIAWIKI_PASSWORD_SELENIUM_USER_WMFLABS_ORG
    mediawiki_url: en.wikipedia.beta.wmflabs.org
    mediawiki_user: Selenium_user
    platform: linux
    recipients: *emails-qa
    repository: mediawiki/extensions/PageTriage

    jobs:
     - 'browsertests-{name}-{mediawiki_url}-{platform}-{browser}-sauce':
        browser: chrome

     - 'browsertests-{name}-{mediawiki_url}-{platform}-{browser}-sauce':
        browser: firefox

# PdfHandler
- project:
    name: PdfHandler
    browser: firefox
    folder: tests
    headless: 'false'
    mediawiki_password_variable: MEDIAWIKI_PASSWORD_SELENIUM_USER_WIKIPEDIA_ORG
    mediawiki_url: test2.wikipedia.org
    mediawiki_user: Selenium_user
    platform: linux
    recipients: *emails-qa
    repository: mediawiki/extensions/PdfHandler

    jobs:
     - 'browsertests-{name}-{mediawiki_url}-{platform}-{browser}-sauce':

# TwnMainPage
- project:
    name: TwnMainPage
    browser: firefox
    folder: tests
    headless: 'false'
    mediawiki_password_variable: MEDIAWIKI_PASSWORD_SELENIUM_SANDBOX_TRANSLATEWIKI_NET
    mediawiki_url: sandbox.translatewiki.net
    mediawiki_user: Selenium
    platform: linux
    recipients: *emails-i18n
    repository: mediawiki/extensions/TwnMainPage

    jobs:
     - 'browsertests-{name}-{mediawiki_url}-{platform}-{browser}-sauce'

# Translate
- project:
    name: Translate
    browser: firefox
    folder: tests
    headless: 'false'
    platform: linux
    recipients: *emails-i18n
    repository: mediawiki/extensions/Translate

    jobs:
     - 'browsertests-{name}-{mediawiki_url}-{platform}-{browser}-sauce':
        mediawiki_password_variable: MEDIAWIKI_PASSWORD_SELENIUM_SANDBOX_TRANSLATEWIKI_NET
        mediawiki_url: meta.wikimedia.org
        mediawiki_user: Selenium

     - 'browsertests-{name}-{mediawiki_url}-{platform}-{browser}-sauce':
        mediawiki_password_variable: MEDIAWIKI_PASSWORD_SELENIUM_TRANSLATE_SANDBOX_TRANSLATEWIKI_NET
        mediawiki_url: sandbox.translatewiki.net
        mediawiki_user: Selenium-Translate
        # Restrict emails notifications since sandbox.translate is unstable/broken
        recipients: *emails-qa-alerts

# UniversalLanguageSelector
- project:
    name: UniversalLanguageSelector
    browser: firefox
    folder: tests
    headless: 'false'
    platform: linux
    recipients: *emails-ULS
    repository: mediawiki/extensions/UniversalLanguageSelector

    jobs:
     - 'browsertests-{name}-{mediawiki_url}-{platform}-{browser}-sauce':
        mediawiki_password_variable: MEDIAWIKI_PASSWORD_ULS_WMFLABS_ORG
        mediawiki_url: commons.wikimedia.beta.wmflabs.org
        mediawiki_user: Uls

     - 'browsertests-{name}-{mediawiki_url}-{platform}-{browser}-sauce':
        mediawiki_password_variable: MEDIAWIKI_PASSWORD_SELENIUM_USER_WMFLABS_ORG
        mediawiki_url: language-browsertests.wmflabs.org
        mediawiki_user: Selenium_user
        # Restrict emails notifications since language-browsertests is unstable/broken
        recipients: *emails-qa-alerts

     - 'browsertests-{name}-{mediawiki_url}-{platform}-{browser}-sauce':
        mediawiki_password_variable: MEDIAWIKI_PASSWORD_SELENIUM_SANDBOX_TRANSLATEWIKI_NET
        mediawiki_url: sandbox.translatewiki.net
        mediawiki_user: Selenium

# UploadWizard
- project:
    name: UploadWizard-api
    mediawiki_user: Selenium_user
    repository: mediawiki/extensions/UploadWizard

    jobs:
     - 'UploadWizard-api-{mediawiki_url}':
        mediawiki_password_variable: MEDIAWIKI_PASSWORD_SELENIUM_USER_WMFLABS_ORG
        mediawiki_url: commons.wikimedia.beta.wmflabs.org
        pollscm: '* * * * *'

     - 'UploadWizard-api-{mediawiki_url}':
        mediawiki_password_variable: MEDIAWIKI_PASSWORD_SELENIUM_USER_WIKIPEDIA_ORG
        mediawiki_url: commons.wikimedia.org
        pollscm: '0 5 31 2 *'

- project:
    name: UploadWizard
    folder: tests
    headless: 'false'
    mediawiki_password_variable: MEDIAWIKI_PASSWORD_SELENIUM_USER_WMFLABS_ORG
    mediawiki_url: commons.wikimedia.beta.wmflabs.org
    mediawiki_user: Selenium_user
    platform: linux
    recipients: *emails-UploadWizard
    repository: mediawiki/extensions/UploadWizard

    jobs:
     - 'browsertests-{name}-{mediawiki_url}-{platform}-{browser}-sauce':
        browser: chrome

     - 'browsertests-{name}-{mediawiki_url}-{platform}-{browser}-sauce':
        browser: firefox

# VisualEditor
- project:
    name: VisualEditor
    folder: modules/ve-mw/tests
    headless: 'false'
    mediawiki_password_variable: MEDIAWIKI_PASSWORD_SELENIUM_USER_WMFLABS_ORG
    mediawiki_url: en.wikipedia.beta.wmflabs.org
    mediawiki_user: Selenium_user
    platform: linux
    recipients: *emails-VisualEditor
    repository: mediawiki/extensions/VisualEditor

    jobs:
     - '{name}-jslint'

     - '{name}-npm'

     - '{name}-ruby1.9.3lint'

     - 'VisualEditor-jsduck'

     - 'browsertests-{name}-{mediawiki_url}-{platform}-{browser}-sauce':
        browser: chrome

     - 'browsertests-{name}-{mediawiki_url}-{platform}-{browser}-sauce':
        browser: firefox

     - 'browsertests-{name}-{mediawiki_url}-{platform}-{browser}-sauce':
        browser: internet_explorer
        platform: 'windows_8'

     - 'browsertests-{name}-{mediawiki_url}-{platform}-{browser}-sauce':
        browser: safari
        platform: 'os_x_10.9'

     - 'browsertests-{name}-{mediawiki_url}-{platform}-{browser}-sauce':
        browser: chrome
        mediawiki_password_variable: MEDIAWIKI_PASSWORD_SELENIUM_USER_WIKIPEDIA_ORG
        mediawiki_url: test2.wikipedia.org

     - 'browsertests-{name}-{mediawiki_url}-{platform}-{browser}-sauce':
        browser: firefox
        mediawiki_password_variable: MEDIAWIKI_PASSWORD_SELENIUM_USER_WIKIPEDIA_ORG
        mediawiki_url: test2.wikipedia.org

     - 'browsertests-{name}-{mediawiki_url}-{platform}-{browser}-sauce':
        browser: internet_explorer
        platform: 'windows_8'
        mediawiki_password_variable: MEDIAWIKI_PASSWORD_SELENIUM_USER_WIKIPEDIA_ORG
        mediawiki_url: test2.wikipedia.org

     - 'browsertests-{name}-{mediawiki_url}-{platform}-{browser}-{version}-sauce':
        browser: internet_explorer
        platform: 'windows_8.1'
        version: '11'

     - 'browsertests-{name}-{mediawiki_url}-{platform}-{browser}-sauce':
        browser: safari
        platform: 'os_x_10.9'
        mediawiki_password_variable: MEDIAWIKI_PASSWORD_SELENIUM_USER_WIKIPEDIA_ORG
        mediawiki_url: test2.wikipedia.org

     - 'browsertests-{name}-production-{platform}-{browser}-sauce':
        browser: firefox

     - 'browsertests-{name}-language-screenshot-{platform}-{browser}':
        browser: firefox
        headless: 'true'
        mediawiki_password_variable: MEDIAWIKI_PASSWORD_LANGUAGESCREENSHOTBOT_WMFLABS_ORG
        mediawiki_user: LanguageScreenshotBot

# Wikidata
- job:
    name: browsertests-Wikidata-wikidata.beta.wmflabs.org-linux-firefox-sauce
    node: contintLabsSlave

    scm:
        - git:
            url: 'https://github.com/wmde/WikidataBrowserTests.git'
            branches:
              - 'master'
            skip-tag: true

    wrappers:
      - ansicolor
      - timestamps

    triggers:
      - timed: 'H 14 * * *'

    builders:
     - shell: |
          # Shared cache of gems to avoid hitting rubygems all the time
          # See https://github.com/bundler/bundler/issues/2856
          export GEM_HOME="$WORKSPACE/../gems"

          # install ruby dependencies
          mkdir -p vendor
          gem1.9.3 install --env-shebang -i vendor bundler --no-ri --no-rdoc
          # Prepare some paths lookup
          export GEM_PATH="`pwd`/vendor"

          cd tests/browser
          "$WORKSPACE"/vendor/bin/bundle install --verbose

          cp config/config_ci.yml config/config.yml

          export WB_REPO_USERNAME=WikidataTester

          export BROWSER=firefox
          export VERSION=25
          export PLATFORM=Linux
          export BROWSER_TIMEOUT=30
          "$WORKSPACE"/vendor/bin/bundle exec cucumber \
            --backtrace \
            --color \
            --verbose  \
            --format pretty \
            --format Cucumber::Formatter::Sauce \
            --out "$WORKSPACE/log/junit" \
            --tags @wikidata.beta.wmflabs.org \
            --tags ~@skip

# WikiLove
- project:
    name: WikiLove
    browser: firefox
    folder: tests
    headless: 'false'
    mediawiki_password_variable: MEDIAWIKI_PASSWORD_SELENIUM_USER_WMFLABS_ORG
    mediawiki_url: en.wikipedia.beta.wmflabs.org
    mediawiki_user: Selenium_user
    platform: linux
    recipients: *emails-qa
    repository: mediawiki/extensions/WikiLove

    jobs:
      - 'browsertests-{name}-{mediawiki_url}-{platform}-{browser}-sauce'

# ZeroBanner
- project:
    name: ZeroBanner
    browser: phantomjs
    folder: tests
    headless: 'true'
    mediawiki_password_variable: MEDIAWIKI_PASSWORD_SELENIUM_USER_WIKIPEDIA_ORG
    mediawiki_url: en.m.wikipedia.org
    mediawiki_user: Selenium_user
    platform: linux
    recipients: *emails-qa
    repository: mediawiki/extensions/ZeroBanner

    jobs:
     - 'browsertests-{name}-{mediawiki_url}-{platform}-{browser}'
