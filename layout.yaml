# vim: set ts=2 sw=2 et ai foldmethod=indent:
#
# This is the Zuul configuration file for the Wikimedia Foundation.
#
# Zuul configuration is organised in three main sections:
#
# - pipelines: Abstracts incoming Gerrit events and what to report back in Gerrit.
#
# - jobs: Override the pipeline configuration on a per job basis.
#    This is how we specificy behaviour for individual projects and jobs.
#
# - projects: For each project we specify what jobs to run, in what order jobs
#    should depend on each other and for which pipelines the jobs should run.
#
# See also upstream documentation:
# - http://ci.openstack.org/zuul/zuul.html#layout-yaml
# - http://ci.openstack.org/zuul/zuul.html#configuration


pipelines:
  # Terminology:
  # - silent: For some pipelines, we do not want to report anything back to
  #    Gerrit, this is useful when trying out a new set of filter or when adding
  #    a new repository in the workflow. Zuul still log the results to
  #    /var/log/zuul.log but simply won't report back to Gerrit.
  # - check: Basic testing run on any submission. Votes V+1
  # - test: More elaborate testing run only after CR+2 or when submitte
  #    by a whitelisted user. Votes V+2.

  - name: check
    manager: IndependentPipelineManager
    trigger:
      - event: patchset-created
        # Don't run the check pipeline if the user is allowd to run the test pipeline (bug 43391).
        # TODO: Figure out a way to turn this into a list instead of a single-line regex.
        # TODO: Figure out a way to not have to repeat this from pipeline 'test'.
        # This email_filter and the one for 'test' can be removed once we have fixed bug 45499.
        email_filter:
         - ^(?!(.*?@wikimedia\.org|.*?@wikimedia\.de|anomie\.wikipedia@gmail\.com|amir\.aharoni@mail\.huji\.ac\.il|hashar@free\.fr|jeroendedauw@gmail\.com|maxsem\.wiki@gmail\.com|mtraceur@member\.fsf\.org|niklas\.laxstrom@gmail\.com|s\.mazeland@xs4all\.nl|stefan\.petrea@gmail\.com|stefan@garage-coding\.com|roan\.kattouw@gmail\.com|krinklemail@gmail\.com|trevorparscal@gmail\.com|inez@wikia-inc\.com|orbit@framezero\.com|aude\.wiki@gmail\.com|bawolff\+wn@gmail\.com|bryan\.tongminh@gmail\.com|dereckson@espace-win\.org|hartman\.wiki@gmail\.com|hoo@online\.de|codereview@emsenhuber\.ch|daniel@nadir-seen-fire\.com|jamesin\.hongkong\.1@gmail\.com|krenair@gmail\.com|liangent@gmail\.com|mah@everybody\.org|matma\.rex@gmail\.com|raimond\.spekking@gmail\.com|robinp\.1273@gmail\.com|tim@tim-landscheidt\.de|tylerromeo@gmail\.com|umherirrender_de\.wp@web\.de|yuriastrakhan@gmail\.com|yaron57@gmail\.com|markus@semantic-mediawiki\.org|s7eph4n@gmail\.org|wiki@physikerwelt\.de)).*$
      - event: comment-added
        comment_filter: (?im)^Patch Set \d+:\n\n\s*recheck\.?\s*$
    success:
      # Only V+1 as these are not elaborate tests. This prevents a change from
      # being merged (requires V+2) before elaborate tests, which vote V+2, have run.
      verified: 1
      code-review: 0
    failure:
      verified: -1
      code-review: 0

  # Use this for projects that don't have a 'test' pipeline. Because the normal 'check'
  # pipeline does not execute for people for whom the test execution is done immediately.s
  - name: check-only
    manager: IndependentPipelineManager
    trigger:
      - event: patchset-created
      - event: comment-added
        comment_filter: (?im)^Patch Set \d+:\n\n\s*recheck\.?\s*$
    success:
      verified: 1
      code-review: 0
    failure:
      verified: -1
      code-review: 0

  - name: check-voter
    manager: IndependentPipelineManager
    trigger:
      - event: patchset-created
      - event: comment-added
        comment_filter: (?im)^Patch Set \d+:\n\n\s*recheck\.?\s*$
    success:
      verified: 2
      code-review: 0
    failure:
      verified: -1
      code-review: 0

  - name: test
    manager: IndependentPipelineManager
    trigger:
      - event: patchset-created

        # BEWARE:
        # - Make sure to use non greedy selectors (.*?) and to escape dots: \.
        # - Also update the email_filter of the 'check' pipeline.

        email_filter:
         - .*?@wikimedia\.org$
         - .*?@wikimedia\.de$

        # WMF staff & contractors:
         - ^anomie\.wikipedia@gmail\.com$
         - ^amir\.aharoni@mail\.huji\.ac\.il$
         - ^hashar@free\.fr$
         - ^jeroendedauw@gmail\.com$
         - ^maxsem\.wiki@gmail\.com$
         - ^mtraceur@member\.fsf\.org$
         - ^niklas\.laxstrom@gmail\.com$
         - ^s\.mazeland@xs4all\.nl$
         - ^stefan\.petrea@gmail\.com$
         - ^stefan@garage-coding\.com$
         - ^roan\.kattouw@gmail\.com$
         - ^krinklemail@gmail\.com$ # Timo Tijhof
         - ^trevorparscal@gmail\.com$

        # VisualEditor (Wikia)
         - ^inez@wikia-inc\.com$
         - ^orbit@framezero\.com$ # Christian Williams

        # WMDE:
         - ^aude\.wiki@gmail\.com$

        # Trusted long term users:
         - ^bawolff\+wn@gmail\.com$
         - ^bryan\.tongminh@gmail\.com$
         - ^dereckson@espace-win\.org$
         - ^hartman\.wiki@gmail\.com$
         - ^hoo@online\.de$
         - ^codereview@emsenhuber\.ch$
         - ^daniel@nadir-seen-fire\.com$
         - ^jamesin\.hongkong\.1@gmail\.com$  # Mwjames
         - ^krenair@gmail\.com$
         - ^liangent@gmail\.com$
         - ^mah@everybody\.org$
         - ^matma\.rex@gmail\.com$
         - ^raimond\.spekking@gmail\.com$
         - ^robinp\.1273@gmail\.com$
         - ^tim@tim-landscheidt\.de$
         - ^tylerromeo@gmail\.com$
         - ^umherirrender_de\.wp@web\.de$
         - ^yuriastrakhan@gmail\.com$
         - ^yaron57@gmail\.com$
         - ^markus@semantic-mediawiki\.org$
         - ^s7eph4n@gmail\.org$ # Foxtrott
         - ^wiki@physikerwelt\.de$

    success:
      verified: 2
      code-review: 0
    failure:
      verified: -1
      code-review: 0

  # Pipelines that only get run when someone trusted has reviewed the code
  # (cr +2). Should be used to run tests and will report verified +2/-2.
  #
  # Silent gate (does not report anything back to Gerrit):
  - name: gate-silent
    manager: IndependentPipelineManager
    trigger:
      - event: comment-added
        approval:
          - code-review: 2

  # Actual gate (report/vote in Gerrit)
  #
  # WARNING: Also update the "gate-and-submit" pipeline when changing this one.
  #
  - name: gate
    manager: IndependentPipelineManager
    trigger:
      - event: comment-added
        approval:
          - code-review: 2
    success:
      verified: 2
      code-review: 0
    failure:
      verified: -1
      code-review: 0

  # Actual gate (report/vote in Gerrit)
  # Will auto submit change on success!!!!!!!!
  #
  # WARNING: Also update the "gate" pipeline when changing this one.
  #
  - name: gate-and-submit
    manager: IndependentPipelineManager
    trigger:
      - event: comment-added
        approval:
          - code-review: 2
    # Let users know we will submit
    start:
      verified: 0
    success:
      verified: 2
      code-review: 0
      # Let Zuul merge the change \O/
      submit: true
    failure:
      verified: -1
      code-review: 0

  # Filter the merge events, useful to do regression testing.
  - name: postmerge
    manager: IndependentPipelineManager
    trigger:
      - event: change-merged

  # Pipeline reacting whenever some reference is updated
  - name: post
    manager: IndependentPipelineManager
    trigger:
     - event: ref-updated
       ref: ^(?!(devnull|refs/.*)).*$

  # Pipeline for tags (either a new one or a removal)
  - name: publish
    manager: IndependentPipelineManager
    trigger:
     - event: ref-updated
       ref: ^refs/tags/.*$

# Fine tune some jobs
jobs:

  #
  # General
  #

  # Warning: the files regex are using python re.match() wich match at the
  # begining of the filename. '.js$' will only match '.js' not 'foo.js'.
  #
  # See: http://docs.python.org/2/library/re.html#search-vs-match

  - name: ^.*-erblint-HEAD$
    voting: false
    files:
     - '^.*\.erb$'

  # puppet manifests
  - name: ^.*-pplint-HEAD$
    files:
     - '^.*\.pp$'

  - name: ^.*-jslint$
    # Non-voting by default (most projects do not pass yet)
    voting: false
    files:
     # Triggers on changes made to .jshintrc* , *.js and *.json
     - '^(\.jshint|.*\.(js|json)$)'

  - name: ^.*-jsduck$
    files:
     - '^.*\.(js|json)$'

  - name: ^.*-jsduck-publish$
    files:
     - '^.*\.(js|json)$'

  - name: ^.*-pep8$
    # Non-voting (most of our script fail the tests miserably)
    voting: false
    files:
     - '^.*\.py$'

  - name: operations-puppet-pep8
    voting: true
    files:
     - '^.*\.py$'
    failure-pattern: 'https://integration.wikimedia.org/ci/job/{job.name}/{build.number}/violations/'

  - name: operations-software-pep8
    voting: true
    files:
     - '^.*\.py$'

  - name: ^.*-pyflakes$
    # do not vote by default
    voting: false
    files:
     - '^.*\.py$'

  # PHP CodeSniffer (experimental)
  - name: ^.*-phpcs$
    voting: false
    files:
     - '^.*\.(php|php5|phtml|inc)$'
  - name: ^.*-phpcs-HEAD$
    voting: false
    files:
     - '^.*\.(php|php5|phtml|inc)$'

  # Rejecting changes having trailing whitespaces cause too many false
  # positives. So only report the whitespace issues, but don't let it vote.
  - name: ^.*-whitespaces$
    voting: false

  #
  # Individual adjustments
  #

  # being tested out
  - name: apps-android-commons-build
    voting: false

  - name: beta-mediawiki-config-update
    branch: ^master$
    success-message: 'Change has been deployed on the beta cluster'
    failure-message: 'Failed deployment on the beta cluster :-/  Please contact a member of the beta project to fixup the working directory on the destination server.'

  - name: integration-docroot-deploy
    branch: ^master$
    success-message: 'Change has been deployed on the server and should be live.'
    failure-message: 'FAILED to deploy change. Please contact a member of the continuous integration team to fixup the docroot on the destination server.'

  - name: 'integration-zuul-layoutdiff'
    voting: false

  - name: 'mwext-VisualEditor-doc-publish'
    branch: ^master$

  - name: mwext-EventLogging-pep8
    voting: true
  - name: sartoris-pep8
    voting: true
  - name: sartoris-pyflakes
    voting: true

  - name: mw-tools-fluoride-pep8
    voting: true
  - name: mw-tools-fluoride-pyflakes
    voting: true
  - name: mw-tools-release-pep8
    voting: true
  - name: operations-debs-ircecho-pep8
    voting: true

  - name: mw-tools-release-pyflakes
    voting: true
  - name: operations-debs-ircecho-pyflakes
    voting: true

  - name: mediawiki-core-jslint
    voting: true
    # Doesn't work in MediaWiki REL1_19 (bug 44846)
    branch: (?!REL1_19)
  - name: mwext-AbuseFilter-jslint
    voting: true
  - name: mwext-ActiveAbstract-jslint
    voting: true
  - name: mwext-AntiBot-jslint
    voting: true
  - name: mwext-AntiSpoof-jslint
    voting: true
  - name: mwext-Calendar-jslint
    voting: true
  - name: mwext-CentralAuth-jslint
    voting: true
  - name: mwext-DataValues-jslint
    voting: true
  - name: mwext-Echo-jslint
    voting: true
  - name: mwext-EventLogging-jslint
    voting: true
  - name: mwext-GuidedTour-jslint
    voting: true
  - name: mwext-GlobalBlocking-jslint
    voting: true
  - name: mwext-Math-jslint
    voting: true
  - name: mwext-MobileFrontend-jslint
    voting: true
  - name: mwext-OpenStackManager-jslint
    voting: true
  - name: mwext-PHPExcel-jslint
    voting: true
  - name: mwext-PostEdit-jslint
    voting: true
  - name: mwext-TemplateSandbox-jslint
    voting: true
  - name: mwext-Translate-jslint
    voting: true
  - name: mwext-TranslationNotifications-jslint
    voting: true
  - name: mwext-TwnMainPage-jslint
    voting: true
  - name: mwext-UniversalLanguageSelector-jslint
    voting: true
  - name: mwext-Vector-jslint
    voting: true
  - name: mwext-VisualEditor-jslint
    voting: true
  - name: mwext-Wikibase-jslint
    voting: true

  - name: mwext-TemplateData-phpcs-HEAD
    voting: true
  - name: mwext-VisualEditor-phpcs-HEAD
    voting: true

  - name: mediawiki-core-qunit
    # Doesn't work in MediaWiki REL1_19
    # (times out or doesn't start in the first place).
    branch: (?!REL1_19)

  - name: mediawiki-core-jsduck
    branch: ^(REL1_21|master)$

  - name: mediawiki-core-jsduck-publish
    branch: ^(REL1_21|master)$

  # not working yet, might need some dependency
  - name: ^mwext-ContributionTracking-testextensions-.*
    voting: false

  # GeoMathTest::testRectWrapAround() fails as of Dec 5th 2012
  - name: ^mwext-GeoData-testextensions.*
    voting: false

  # LabeledSectionTransclusion has only parser tests which does not
  # play well for now. https://gerrit.wikimedia.org/r/#/c/38114 should
  # let PHPUnit load in the parser tests though. See bug 42506.
  - name: ^mwext-LabeledSectionTransclusion-testextensions.*
    voting: false


  #
  # Extensions for which parser tests are not passing :-(
  #

  # https://bugzilla.wikimedia.org/49879
  - name: ^mwext-BookManager-testextensions.*
    voting: false

  # https://bugzilla.wikimedia.org/49881
  - name: ^mwext-NaturalLanguageList-testextensions.*
    voting: false

  # https://bugzilla.wikimedia.org/49882
  - name: ^mwext-Transliterator-testextensions.*
    voting: false


  # texvc needs to be build before we run parser tests on Math
  # https://bugzilla.wikimedia.org/49884
  - name: ^mwext-Math-testextensions.*
    voting: false


  # The JsonData phpunit tests are meant to be independant and
  # do not play well with the MediaWiki phpunit wrapper for now :(
  # See also: https://gerrit.wikimedia.org/r/#/c/52292/
  - name: ^mwext-JsonData-testextensions.*
    voting: false

  # Has an insert that introduce multiple values, that requires SQLite
  # version 3.7.11
  - name: ^mwext-PageTriage-testextensions-master
    voting: false

  # Completely broken test suite
  - name: ^mwext-PagedTiffHandler-testextensions-master.*
    voting: false

  - name: ^mwext-Wikibase-testextensions-.*
    voting: false

  # MediaWiki core regression tests (on merge and per branches):
  - name: ^mediawiki-core-regression-.*
    failure-message: ERROR! It seems this job introduced a regression although it might be caused by a previous commit.
  - name: mediawiki-core-regression-master
    branch: ^master$
  - name: mediawiki-core-regression-REL1_19
    branch: ^REL1_19$
  - name: mediawiki-core-regression-REL1_20
    branch: ^REL1_20$
  - name: mediawiki-core-regression-REL1_21
    branch: ^REL1_21

  # Extensions for which tests are non-functional or absent:
  - name: ^mwext-EtherEditor-testextensions.*
    voting: false
  - name: ^mwext-cldr-testextensions.*
    voting: false

  - name: ^operations-debs-python-voluptuous-debbuild.*
    voting: false

  # Parsoid is jslint-clean!  Let's keep it that way!
  - name: mwext-Parsoid-jslint
    voting: true

project-templates:

  # Template for MediaWiki extensions.
  # Does run the unit tests on 'test' and 'gate-and-submit'
  - name: extension-unittests
    check:
     - 'mwext-{extname}-merge':
       - 'mwext-{extname}-jslint'
       - 'mwext-{extname}-lint'
    test:
     - 'mwext-{extname}-merge':
       - 'mwext-{extname}-jslint'
       - 'mwext-{extname}-lint':
         - 'mwext-{extname}-testextensions-master'
    gate-and-submit:
     - 'mwext-{extname}-merge':
       - 'mwext-{extname}-jslint'
       - 'mwext-{extname}-lint':
         - 'mwext-{extname}-testextensions-master'

  # Template for MediaWiki extensions.
  # No unit tests but vote on linting.
  - name: extension-checks
    check-only:
     - 'mwext-{extname}-merge':
       - 'mwext-{extname}-jslint'
       - 'mwext-{extname}-lint'
    gate-and-submit:
     - 'mwext-{extname}-merge':
       - 'mwext-{extname}-jslint'
       - 'mwext-{extname}-lint'

  - name: python-lint
    check-voter:
      - '{prefix}-pep8'
      - '{prefix}-pyflakes'
    gate-and-submit:
      - '{prefix}-pep8'
      - '{prefix}-pyflakes'

  - name: puppet
    # FIXME add merge probably
    # voting since we usually do not have any unit tests
    check-voter:
      - 'operations-puppet-{module}-erblint-HEAD'
      - 'operations-puppet-{module}-pplint-HEAD'

# Register the Gerrit project name, apply them pipelines that in turn trigger
# a set of jobs.
projects:
  - name: integration/jenkins
    template:
      - name: 'python-lint'
        prefix: 'integration-jenkins'

  - name: integration/jenkins-job-builder-config
    # FIXME: make this 'check' whenever we have integration tests
    check-voter:
      - integration-jjb-config-yamllint

  - name: integration/zuul-config
    # FIXME: make this 'check' whenever we have integration tests
    check-voter:
      - integration-zuul-config-yamllint
      - integration-zuul-layoutvalidation
      - integration-zuul-layoutdiff
    gate-and-submit:
      - integration-zuul-config-yamllint
      - integration-zuul-layoutvalidation
      - integration-zuul-layoutdiff

  - name: mediawiki/core
    check:
      - mediawiki-core-merge:
        - mediawiki-core-whitespaces
        - mediawiki-core-phpcs-HEAD
        - mediawiki-core-jslint
        - mediawiki-core-jsduck
        - mediawiki-core-lint
    test:
      - mediawiki-core-merge:
        - mediawiki-core-phpcs-HEAD
        - mediawiki-core-jslint
        - mediawiki-core-jsduck
        - mediawiki-core-lint:
          - mediawiki-core-phpunit-databaseless:
            - mediawiki-core-install-sqlite:
              - mediawiki-core-qunit
              - mediawiki-core-phpunit-api
              - mediawiki-core-phpunit-misc
              - mediawiki-core-phpunit-parser
    gate-and-submit:
      - mediawiki-core-merge:
        - mediawiki-core-phpcs-HEAD
        - mediawiki-core-jslint
        - mediawiki-core-jsduck
        - mediawiki-core-lint:
          - mediawiki-core-phpunit-databaseless:
            - mediawiki-core-install-sqlite:
              - mediawiki-core-qunit
              - mediawiki-core-phpunit-api
              - mediawiki-core-phpunit-misc
              - mediawiki-core-phpunit-parser
    postmerge:
      - mediawiki-core-jslint
      - mediawiki-core-lint
      - mediawiki-core-jsduck-publish
      - mediawiki-core-regression-master
      - mediawiki-core-regression-REL1_19
      - mediawiki-core-regression-REL1_20
      - mediawiki-core-regression-REL1_21
      - mediawiki-core-regression-phpcs-HEAD
      - mediawiki-core-doxygen-publish

  - name: analytics/asana-stats
    template:
      - name: 'python-lint'
        prefix: 'analytics-asana-stats'

  - name: analytics/check-stats
    template:
      - name: 'python-lint'
        prefix: 'analytics-check-stats'

  - name: analytics/editor-geocoding
    template:
      - name: 'python-lint'
        prefix: 'analytics-editor-geocoding'

  - name: analytics/gerrit-stats
    template:
      - name: 'python-lint'
        prefix: 'analytics-gerrit-stats'

  - name: analytics/glass
    template:
      - name: 'python-lint'
        prefix: 'analytics-glass'

  - name: analytics/reportcard
    template:
      - name: 'python-lint'
        prefix: 'analytics-reportcard'

  - name: analytics/libanon
    test:
     - analytics-libanon
    gate:
     - analytics-libanon
    postmerge:
     - analytics-libanon

  - name: analytics/udp-filters
    test:
     - analytics-udp-filters
    gate:
     - analytics-udp-filters
    postmerge:
     - analytics-udp-filters

  - name: analytics/webstatscollector
    test:
     - analytics-webstatscollector
    gate:
     - analytics-webstatscollector
    postmerge:
     - analytics-webstatscollector

  - name: analytics/wikistats
    test:
     - analytics-wikistats
    gate:
     - analytics-wikistats
    postmerge:
     - analytics-wikistats

  - name: apps/android/commons
    test:
      - apps-android-commons-build
    gate-and-submit:
      - apps-android-commons-build

  - name: labs/incubator
    check-voter:
     - labs-incubator-phplint
    gate-and-submit:
     - labs-incubator-phplint

  - name: labs/nagios-builder
    template:
      - name: 'python-lint'
        prefix: 'labs-nagios-builder'

  - name: integration/docroot
    check-voter:
     - integration-docroot-phplint
     - integration-docroot-jslint
    test:
     - integration-docroot-phplint
     - integration-docroot-jslint
    gate-and-submit:
     - integration-docroot-phplint
     - integration-docroot-jslint
    postmerge:
     - integration-docroot-deploy

  - name: mediawiki/skins/erudite
    check-voter:
     - mw-skins-erudite-phplint
    gate-and-submit:
     - mw-skins-erudite-phplint

  - name: mediawiki/skins/mediawiki-strapping
    check-voter:
     - mw-skins-mediawiki-strapping-phplint
    gate-and-submit:
     - mw-skins-mediawiki-strapping-phplint

  - name: mediawiki/skins/webplatform
    check-voter:
     - mw-skins-webplatform-phplint
    gate-and-submit:
     - mw-skins-webplatform-phplint

  - name: mediawiki/tools/code-utils
    check-voter:
     - mw-tools-codeutils-pep8
     - mw-tools-codeutils-phplint
    gate-and-submit:
     - mw-tools-codeutils-pep8
     - mw-tools-codeutils-phplint

  - name: mediawiki/tools/dippybird
    check-voter:
     - mw-tools-dippybird-phplint
    gate-and-submit:
     - mw-tools-dippybird-phplint

  - name: mediawiki/tools/fluoride
    template:
      - name: 'python-lint'
        prefix: 'mw-tools-fluoride'

  - name: mediawiki/tools/release
    # bug 50112 : we should use the python-lint template + the phplint
    check-voter:
      - mw-tools-release-phplint
      - mw-tools-release-pep8
      - mw-tools-release-pyflakes
    gate-and-submit:
      - mw-tools-release-phplint
      - mw-tools-release-pep8
      - mw-tools-release-pyflakes

  - name: mediawiki/vagrant
    check-voter:
      - mediawiki-vagrant-puppet-validate
    gate-and-submit:
      - mediawiki-vagrant-puppet-validate

  - name: operations/apache-config
    # FIXME: convert back to "check" pipeline whenever we have
    # integration tests
    check-voter:
      - operations-apache-config-lint
    gate-and-submit:
      - operations-apache-config-lint

  - name: operations/debs/adminbot
    template:
      - name: 'python-lint'
        prefix: 'operations-debs-adminbot'

  - name: operations/debs/ircecho
    template:
      - name: 'python-lint'
        prefix: 'operations-debs-ircecho'

  - name: operations/debs/lucene-search-2
    test:
     - lucene-search-2-antbuild
    gate-and-submit:
     - lucene-search-2-antbuild

  - name: operations/debs/python-voluptuous
    test:
     - operations-debs-python-voluptuous-debbuild

  - name: operations/dumps
    check-voter:
      - operations-dumps-pep8
    gate-and-submit:
      - operations-dumps-pep8

  - name: operations/mediawiki-config
    check:
      - operations-mw-config-phplint
    test:
      - operations-mw-config-phplint:
        - operations-mw-config-tests
    gate-and-submit:
      - operations-mw-config-phplint:
        - operations-mw-config-tests
    postmerge:
      - beta-mediawiki-config-update

  - name: operations/puppet
    # Only lint on submission for now, that will be voting
    check-voter:
      - operations-puppet-erblint-HEAD
      - operations-puppet-pep8
      - operations-puppet-typos
      - operations-puppet-validate
    postmerge:
      - operations-puppet-doc

  - name: operations/puppet/cdh4
    template:
      - name: puppet
        module: cdh4

  - name: operations/puppet/kafka
    template:
      - name: puppet
        module: kafka

  - name: operations/puppet/zookeeper
    template:
      - name: puppet
        module: zookeeper

  - name: operations/software
    check-voter:
      - operations-software-pep8

  - name: operations/software/redactatron
    check-voter:
      - operations-software-redactatron-pep8
    gate-and-submit:
      - operations-software-redactatron-pep8

  - name: translatewiki
    check-only:
      - translatewiki-phplint
      - translatewiki-puppet-validate
      - translatewiki-shelllint
      - translatewiki-yamllint
    gate-and-submit:
      - translatewiki-phplint
      - translatewiki-puppet-validate
      - translatewiki-shelllint
      - translatewiki-yamllint

  - name: wikimedia/bugzilla/wikibugs
    # Only lint on submission for now, that will be voting
    check-voter:
      - wikimedia-bugzilla-wikibugs-perllint

#### MediaWiki extensions ######################################

  - name: mediawiki/extensions/AbuseFilter
    template:
      - name: extension-checks
        extname: AbuseFilter

  - name: mediawiki/extensions/ActiveAbstract
    template:
      - name: extension-unittests
        extname: ActiveAbstract

  - name: mediawiki/extensions/AdminLinks
    template:
      - name: extension-checks
        extname: AdminLinks

  - name: mediawiki/extensions/Agora
    template:
      - name: extension-checks
        extname: Agora

  - name: mediawiki/extensions/AntiBot
    template:
      - name: extension-checks
        extname: AntiBot

  - name: mediawiki/extensions/AntiSpoof
    template:
      - name: extension-unittests
        extname: AntiSpoof

  - name: mediawiki/extensions/APC
    template:
      - name: extension-checks
        extname: APC

  - name: mediawiki/extensions/ArticleFeedbackv5
    template:
      - name: extension-checks
        extname: ArticleFeedbackv5

  - name: mediawiki/extensions/ApiSandbox
    template:
      - name: extension-checks
        extname: ApiSandbox

  - name: mediawiki/extensions/Arrays
    template:
      - name: extension-unittests
        extname: Arrays

  - name: mediawiki/extensions/Ask
    template:
      - name: extension-unittests
        extname: Ask

  - name: mediawiki/extensions/Babel
    template:
      - name: extension-checks
        extname: Babel

  - name: mediawiki/extensions/BlameMaps
    check-only:
      - mwext-BlameMaps-merge:
        - mwext-BlameMaps-jslint
        - mwext-BlameMaps-lint
        - mwext-BlameMaps-pep8
    gate-and-submit:
      - mwext-BlameMaps-merge:
        - mwext-BlameMaps-jslint
        - mwext-BlameMaps-lint
        - mwext-BlameMaps-pep8

  - name: mediawiki/extensions/BookManager
    template:
      - name: extension-unittests
        extname: BookManager

  - name: mediawiki/extensions/Calendar
    template:
      - name: extension-checks
        extname: Calendar

  - name: mediawiki/extensions/Campaigns
    template:
      - name: extension-checks
        extname: Campaigns

  - name: mediawiki/extensions/CategoryTree
    template:
      - name: extension-checks
        extname: CategoryTree

  - name: mediawiki/extensions/CharInsert
    template:
      - name: extension-checks
        extname: CharInsert

  - name: mediawiki/extensions/CheckUser
    template:
      - name: extension-checks
        extname: CheckUser

  - name: mediawiki/extensions/Cite
    template:
      - name: extension-unittests
        extname: Cite

  # FIXME use a template
  - name: mediawiki/extensions/cldr
    check-only:
      - mwext-cldr-merge:
        - mwext-cldr-jslint
        - mwext-cldr-lint
    gate-and-submit:
      - mwext-cldr-merge:
        - mwext-cldr-jslint
        - mwext-cldr-lint:
          - mwext-cldr-testextensions-master

  - name: mediawiki/extensions/CentralAuth
    template:
      - name: extension-checks
        extname: CentralAuth

  - name: mediawiki/extensions/CentralNotice
    template:
      - name: extension-unittests
        extname: CentralNotice

  - name: mediawiki/extensions/CirrusSearch
    template:
      - name: extension-checks
        extname: CirrusSearch

  - name: mediawiki/extensions/CleanChanges
    template:
      - name: extension-checks
        extname: CleanChanges

  - name: mediawiki/extensions/ClickTracking
    template:
      - name: extension-checks
        extname: ClickTracking

  - name: mediawiki/extensions/ClientSide
    template:
      - name: extension-checks
        extname: ClientSide

  - name: mediawiki/extensions/CodeEditor
    template:
      - name: extension-checks
        extname: CodeEditor

  - name: mediawiki/extensions/CodeReview
    template:
      - name: extension-unittests
        extname: CodeReview

  - name: mediawiki/extensions/Collection
    template:
      - name: extension-checks
        extname: Collection

  # FIXME: it has pep8
  - name: mediawiki/extensions/ConfirmEdit
    check-only:
      - mwext-ConfirmEdit-merge:
        - mwext-ConfirmEdit-jslint
        - mwext-ConfirmEdit-lint
        - mwext-ConfirmEdit-pep8
    gate-and-submit:
      - mwext-ConfirmEdit-merge:
        - mwext-ConfirmEdit-jslint
        - mwext-ConfirmEdit-lint
        - mwext-ConfirmEdit-pep8

  - name: mediawiki/extensions/ContributionScores
    template:
      - name: extension-checks
        extname: ContributionScores

  - name: mediawiki/extensions/CommunityApplications
    template:
      - name: extension-checks
        extname: CommunityApplications

  - name: mediawiki/extensions/CommunityHiring
    template:
      - name: extension-checks
        extname: CommunityHiring

  - name: mediawiki/extensions/CommunityVoice
    template:
      - name: extension-checks
        extname: CommunityVoice

  - name: mediawiki/extensions/ContactPage
    template:
      - name: extension-checks
        extname: ContactPage

  - name: mediawiki/extensions/ContactPageFundraiser
    template:
      - name: extension-checks
        extname: ContactPageFundraiser

  - name: mediawiki/extensions/ContributionReporting
    template:
      - name: extension-checks
        extname: ContributionReporting

  - name: mediawiki/extensions/ContributionTracking
    template:
      - name: extension-unittests
        extname: ContributionTracking

  - name: mediawiki/extensions/CoreEvents
    template:
      - name: extension-checks
        extname: CoreEvents

  - name: mediawiki/extensions/CreditsSource
    template:
      - name: extension-checks
        extname: CreditsSource

  - name: mediawiki/extensions/CustomData
    template:
      - name: extension-checks
        extname: CustomData

  - name: mediawiki/extensions/CustomUserSignup
    template:
      - name: extension-checks
        extname: CustomUserSignup

  - name: mediawiki/extensions/DataValues
    template:
      - name: extension-unittests
        extname: DataValues

  - name: mediawiki/extensions/DonationInterface
    template:
      - name: extension-checks
        extname: DonationInterface

  - name: mediawiki/extensions/DeleteBatch
    template:
      - name: extension-checks
        extname: DeleteBatch

  - name: mediawiki/extensions/Diff
    template:
      - name: extension-unittests
        extname: Diff

  - name: mediawiki/extensions/DisableAccount
    template:
      - name: extension-checks
        extname: DisableAccount

  - name: mediawiki/extensions/DismissableSiteNotice
    template:
      - name: extension-checks
        extname: DismissableSiteNotice

  - name: mediawiki/extensions/DoubleWiki
    template:
      - name: extension-checks
        extname: DoubleWiki

  - name: mediawiki/extensions/DynamicSidebar
    template:
      - name: extension-checks
        extname: DynamicSidebar

  - name: mediawiki/extensions/DumpHTML
    check-only:
      - mwext-DumpHTML-merge:
        - mwext-DumpHTML-jslint
        - mwext-DumpHTML-lint
        - mwext-DumpHTML-pep8
    gate-and-submit:
      - mwext-DumpHTML-merge:
        - mwext-DumpHTML-jslint
        - mwext-DumpHTML-lint
        - mwext-DumpHTML-pep8

  - name: mediawiki/extensions/E3Experiments
    template:
      - name: extension-unittests
        extname: E3Experiments

  - name: mediawiki/extensions/Echo
    template:
      - name: extension-unittests
        extname: Echo

  - name: mediawiki/extensions/EditPageTracking
    template:
      - name: extension-checks
        extname: EditPageTracking

  - name: mediawiki/extensions/EducationProgram
    template:
      - name: extension-unittests
        extname: EducationProgram

  - name: mediawiki/extensions/EmailCapture
    template:
      - name: extension-checks
        extname: EmailCapture

  - name: mediawiki/extensions/EtherEditor
    template:
      - name: extension-unittests
        extname: EtherEditor

  - name: mediawiki/extensions/EventLogging
    check:
      - mwext-EventLogging-merge:
        - mwext-EventLogging-jslint
        - mwext-EventLogging-pep8
        - mwext-EventLogging-lint
    test:
      - mwext-EventLogging-merge:
        - mwext-EventLogging-jslint
        - mwext-EventLogging-pep8
        - mwext-EventLogging-lint:
          - mwext-EventLogging-testextensions-master
          - mwext-EventLogging-qunit
    gate-and-submit:
      - mwext-EventLogging-merge:
        - mwext-EventLogging-jslint
        - mwext-EventLogging-pep8
        - mwext-EventLogging-lint:
          - mwext-EventLogging-testextensions-master
          - mwext-EventLogging-qunit

  - name: mediawiki/extensions/ExpandTemplates
    template:
      - name: extension-checks
        extname: ExpandTemplates

  - name: mediawiki/extensions/ExtensionDistributor
    template:
      - name: extension-checks
        extname: ExtensionDistributor

  - name: mediawiki/extensions/FeaturedFeeds
    template:
      - name: extension-checks
        extname: FeaturedFeeds

  - name: mediawiki/extensions/FormPreloadPostCache
    template:
      - name: extension-checks
        extname: FormPreloadPostCache

  - name: mediawiki/extensions/Foxway
    template:
      - name: extension-unittests
        extname: Foxway

  - name: mediawiki/extensions/FundraiserLandingPage
    template:
      - name: extension-checks
        extname: FundraiserLandingPage

  - name: mediawiki/extensions/Gadgets
    template:
      - name: extension-unittests
        extname: Gadgets

  - name: mediawiki/extensions/GettingStarted
    template:
      - name: extension-checks
        extname: GettingStarted

  - name: mediawiki/extensions/GeoCrumbs
    template:
      - name: extension-checks
        extname: GeoCrumbs

  - name: mediawiki/extensions/GeoData
    template:
      - name: extension-unittests
        extname: GeoData

  - name: mediawiki/extensions/GlobalBlocking
    template:
      - name: extension-checks
        extname: GlobalBlocking

  - name: mediawiki/extensions/GlobalUsage
    template:
      - name: extension-checks
        extname: GlobalUsage

  - name: mediawiki/extensions/GoogleAdSense
    template:
      - name: extension-checks
        extname: GoogleAdSense

  - name: mediawiki/extensions/GoogleCustomWikiSearch
    template:
      - name: extension-checks
        extname: GoogleCustomWikiSearch

  - name: mediawiki/extensions/GoogleNewsSitemap
    template:
      - name: extension-checks
        extname: GoogleNewsSitemap

  - name: mediawiki/extensions/GuidedTour
    check:
     - mwext-GuidedTour-merge:
       - mwext-GuidedTour-jslint
       - mwext-GuidedTour-lint
    test:
     - mwext-GuidedTour-merge:
       - mwext-GuidedTour-jslint
       - mwext-GuidedTour-lint:
         - mwext-GuidedTour-testextensions-master
         - mwext-GuidedTour-qunit
    gate-and-submit:
     - mwext-GuidedTour-merge:
       - mwext-GuidedTour-jslint
       - mwext-GuidedTour-lint:
         - mwext-GuidedTour-testextensions-master
         - mwext-GuidedTour-qunit

  - name: mediawiki/extensions/I18nTags
    template:
      - name: extension-checks
        extname: I18nTags

  - name: mediawiki/extensions/ImageMap
    template:
      - name: extension-checks
        extname: ImageMap

  - name: mediawiki/extensions/InputBox
    template:
      - name: extension-checks
        extname: InputBox

  - name: mediawiki/extensions/Insider
    template:
      - name: extension-checks
        extname: Insider

  - name: mediawiki/extensions/Interwiki
    template:
      - name: extension-checks
        extname: Interwiki

  - name: mediawiki/extensions/intersection
    template:
      - name: extension-checks
        extname: intersection

  - name: mediawiki/extensions/JsonData
    template:
      - name: extension-unittests
        extname: JsonData

  - name: mediawiki/extensions/LabeledSectionTransclusion
    template:
      - name: extension-unittests
        extname: LabeledSectionTransclusion

  - name: mediawiki/extensions/LandingCheck
    template:
      - name: extension-checks
        extname: LandingCheck

  - name: mediawiki/extensions/LastModified
    template:
      - name: extension-checks
        extname: LastModified

  - name: mediawiki/extensions/LdapAuthentication
    template:
      - name: extension-checks
        extname: LdapAuthentication

  - name: mediawiki/extensions/LiquidThreads
    template:
      - name: extension-checks
        extname: LiquidThreads

  - name: mediawiki/extensions/Listings
    template:
      - name: extension-checks
        extname: Listings

  - name: mediawiki/extensions/LocalisationUpdate
    template:
      - name: extension-checks
        extname: LocalisationUpdate

  - name: mediawiki/extensions/Math
    template:
      - name: extension-unittests
        extname: Math
    postmerge:
      - beta-recompile-math-texvc

  - name: mediawiki/extensions/Maps
    template:
      - name: extension-unittests
        extname: Maps

  - name: mediawiki/extensions/MapSources
    template:
      - name: extension-checks
        extname: MapSources

  - name: mediawiki/extensions/MarkAsHelpful
    template:
      - name: extension-checks
        extname: MarkAsHelpful

  - name: mediawiki/extensions/MobileFrontend
    check-only:
      - mwext-MobileFrontend-merge:
        - mwext-MobileFrontend-lint
        - mwext-MobileFrontend-jslint
        - mwext-MobileFrontend-ruby1.9.3lint
    gate-and-submit:
      - mwext-MobileFrontend-merge:
        - mwext-MobileFrontend-jslint
        - mwext-MobileFrontend-lint:
          - mwext-MobileFrontend-testextensions-master
        - mwext-MobileFrontend-ruby1.9.3lint

  - name: mediawiki/extensions/MoodBar
    template:
      - name: extension-checks
        extname: MoodBar

  - name: mediawiki/extensions/MultiMaps
    template:
      - name: extension-unittests
        extname: MultiMaps

  - name: mediawiki/extensions/MwEmbedSupport
    template:
      - name: extension-checks
        extname: MwEmbedSupport

  - name: mediawiki/extensions/MWSearch
    template:
      - name: extension-checks
        extname: MWSearch

  # TODO: add qunit
  - name: mediawiki/extensions/Narayam
    template:
      - name: extension-checks
        extname: Narayam

  - name: mediawiki/extensions/NaturalLanguageList
    template:
      - name: extension-unittests
        extname: NaturalLanguageList

  - name: mediawiki/extensions/NavigationTiming
    template:
      - name: extension-checks
        extname: NavigationTiming

  - name: mediawiki/extensions/NewUserMessage
    template:
      - name: extension-checks
        extname: NewUserMessage

  - name: mediawiki/extensions/Nonlinear
    template:
      - name: extension-unittests
        extname: Nonlinear

  - name: mediawiki/extensions/Nuke
    template:
      - name: extension-checks
        extname: Nuke

  - name: mediawiki/extensions/OATHAuth
    template:
      - name: extension-checks
        extname: OATHAuth

  - name: mediawiki/extensions/OAI
    template:
      - name: extension-checks
        extname: OAI

  - name: mediawiki/extensions/Offline
    check-only:
      - mwext-Offline-merge:
        - mwext-Offline-jslint
        - mwext-Offline-lint
        - mwext-Offline-pep8
    gate-and-submit:
      - mwext-Offline-merge:
        - mwext-Offline-jslint
        - mwext-Offline-lint
        - mwext-Offline-pep8

  - name: mediawiki/extensions/OpenID
    template:
      - name: extension-checks
        extname: OpenID

  - name: mediawiki/extensions/OpenSearchXml
    template:
      - name: extension-checks
        extname: OpenSearchXml

  - name: mediawiki/extensions/OpenStackManager
    check-only:
      - mwext-OpenStackManager-merge:
        - mwext-OpenStackManager-jslint
        - mwext-OpenStackManager-lint
        - mwext-OpenStackManager-pep8
    gate-and-submit:
      - mwext-OpenStackManager-merge:
        - mwext-OpenStackManager-jslint
        - mwext-OpenStackManager-pep8
        - mwext-OpenStackManager-lint

  - name: mediawiki/extensions/PagedTiffHandler
    template:
      - name: extension-unittests
        extname: PagedTiffHandler

  - name: mediawiki/extensions/PageImages
    template:
      - name: extension-checks
        extname: PageImages

  - name: mediawiki/extensions/PageTriage
    template:
      - name: extension-unittests
        extname: PageTriage

  - name: mediawiki/extensions/ParserFunctions
    template:
      - name: extension-unittests
        extname: ParserFunctions

  - name: mediawiki/extensions/ParserHooks
    template:
      - name: extension-unittests
        extname: ParserHooks

  - name: mediawiki/extensions/Parsoid
    check:
      - mwext-Parsoid-merge:
        - mwext-Parsoid-jslint
        - mwext-Parsoid-phpcs-HEAD
    test:
      - mwext-Parsoid-merge:
        - mwext-Parsoid-jslint
        - mwext-Parsoid-phpcs-HEAD
        # SSS: parsoid-parsertests-run-hader is now self-documenting wrt
        # test failures.  So, no need to run this more complex test script.
        # - parsoid-parsertests
        - parsoid-parse-tool-check
        - parsoid-roundtrip-test-check
        - parsoid-parsertests-run-harder
    gate-and-submit:
      - mwext-Parsoid-merge:
        - mwext-Parsoid-jslint
        - mwext-Parsoid-phpcs-HEAD
        # SSS: parsoid-parsertests-run-hader is now self-documenting wrt
        # test failures.  So, no need to run this more complex test script.
        # - parsoid-parsertests
        - parsoid-parsertests-run-harder
    postmerge:
      - parsoid-regressions

  - name: mediawiki/extensions/PdfHandler
    template:
      - name: extension-checks
        extname: PdfHandler

  - name: mediawiki/extensions/PHPExcel
    template:
      - name: extension-checks
        extname: PHPExcel

  - name: mediawiki/extensions/Poem
    template:
      - name: extension-unittests
        extname: Poem

  - name: mediawiki/extensions/PoolCounter
    check:
      - mwext-PoolCounter-merge:
        - mwext-PoolCounter-jslint
        - mwext-PoolCounter-lint
    test:
      - mwext-PoolCounter-merge:
        - mwext-PoolCounter-jslint
        - mwext-PoolCounter-lint
        - mwext-PoolCounter-build
    gate-and-submit:
      - mwext-PoolCounter-merge:
        - mwext-PoolCounter-jslint
        - mwext-PoolCounter-lint
        - mwext-PoolCounter-build

  - name: mediawiki/extensions/PostEdit
    template:
      - name: extension-checks
        extname: PostEdit

  - name: mediawiki/extensions/ProofreadPage
    template:
      - name: extension-unittests
        extname: ProofreadPage

  - name: mediawiki/extensions/Quiz
    template:
      - name: extension-checks
        extname: Quiz

  - name: mediawiki/extensions/RandomRootPage
    template:
      - name: extension-checks
        extname: RandomRootPage

  - name: mediawiki/extensions/ReaderFeedback
    template:
      - name: extension-checks
        extname: ReaderFeedback

  - name: mediawiki/extensions/RelatedArticles
    template:
      - name: extension-checks
        extname: RelatedArticles

  - name: mediawiki/extensions/RelatedSites
    template:
      - name: extension-checks
        extname: RelatedSites

  - name: mediawiki/extensions/Renameuser
    template:
      - name: extension-checks
        extname: Renameuser

  - name: mediawiki/extensions/ReplaceSet
    template:
      - name: extension-unittests
        extname: ReplaceSet

  - name: mediawiki/extensions/ReplaceText
    template:
      - name: extension-checks
        extname: ReplaceText

  - name: mediawiki/extensions/RSS
    template:
      - name: extension-checks
        extname: RSS

  - name: mediawiki/extensions/Score
    template:
      - name: extension-checks
        extname: Score

  - name: mediawiki/extensions/SearchExtraNS
    template:
      - name: extension-checks
        extname: SearchExtraNS

  - name: mediawiki/extensions/SecurePoll
    template:
      - name: extension-checks
        extname: SecurePoll

  - name: mediawiki/extensions/SemanticACL
    template:
      - name: extension-checks
        extname: SemanticACL

  - name: mediawiki/extensions/SemanticBundle
    check-only:
     - mwext-SemanticBundle-merge:
       - mwext-SemanticBundle-jslint
       - mwext-SemanticBundle-lint
       - mwext-SemanticBundle-pep8
    gate-and-submit:
     - mwext-SemanticBundle-merge:
       - mwext-SemanticBundle-jslint
       - mwext-SemanticBundle-lint
       - mwext-SemanticBundle-pep8

  - name: mediawiki/extensions/SemanticCompoundQueries
    template:
      - name: extension-checks
        extname: SemanticCompoundQueries

  - name: mediawiki/extensions/SemanticDrilldown
    template:
      - name: extension-checks
        extname: SemanticDrilldown

  - name: mediawiki/extensions/SemanticExpressiveness
    template:
      - name: extension-checks
        extname: SemanticExpressiveness

  - name: mediawiki/extensions/SemanticExtraSpecialProperties
    template:
      - name: extension-checks
        extname: SemanticExtraSpecialProperties

  - name: mediawiki/extensions/SemanticForms
    template:
      - name: extension-checks
        extname: SemanticForms

  - name: mediawiki/extensions/SemanticFormsInputs
    template:
      - name: extension-checks
        extname: SemanticFormsInputs

  - name: mediawiki/extensions/SemanticGenealogy
    template:
      - name: extension-checks
        extname: SemanticGenealogy

  - name: mediawiki/extensions/SemanticGlossary
    template:
      - name: extension-checks
        extname: SemanticGlossary

  - name: mediawiki/extensions/SemanticImageAnnotator
    template:
      - name: extension-checks
        extname: SemanticImageAnnotator

  - name: mediawiki/extensions/SemanticImageInput
    template:
      - name: extension-checks
        extname: SemanticImageInput

  - name: mediawiki/extensions/SemanticInternalObjects
    template:
      - name: extension-checks
        extname: SemanticInternalObjects

  - name: mediawiki/extensions/SemanticMaps
    template:
      - name: extension-checks
        extname: SemanticMaps

  - name: mediawiki/extensions/SemanticMediaWiki
    template:
      - name: extension-unittests
        extname: SemanticMediaWiki

  - name: mediawiki/extensions/SemanticPageMaker
    template:
      - name: extension-checks
        extname: SemanticPageMaker

  - name: mediawiki/extensions/SemanticPageSeries
    template:
      - name: extension-checks
        extname: SemanticPageSeries

  - name: mediawiki/extensions/SemanticResultFormats
    template:
      - name: extension-checks
        extname: SemanticResultFormats

  - name: mediawiki/extensions/SemanticSignup
    template:
      - name: extension-checks
        extname: SemanticSignup

  - name: mediawiki/extensions/SemanticTasks
    template:
      - name: extension-checks
        extname: SemanticTasks

  - name: mediawiki/extensions/SemanticTitle
    template:
      - name: extension-checks
        extname: SemanticTitle

  - name: mediawiki/extensions/SemanticUpdateOnPurge
    template:
      - name: extension-checks
        extname: SemanticUpdateOnPurge

  - name: mediawiki/extensions/SemanticWatchlist
    template:
      - name: extension-checks
        extname: SemanticWatchlist

  - name: mediawiki/extensions/Scribunto
    template:
      - name: extension-unittests
        extname: Scribunto

  - name: mediawiki/extensions/ShortUrl
    template:
      - name: extension-checks
        extname: ShortUrl

  - name: mediawiki/extensions/SimpleAntiSpam
    template:
      - name: extension-checks
        extname: SimpleAntiSpam

  - name: mediawiki/extensions/SiteMatrix
    template:
      - name: extension-checks
        extname: SiteMatrix

  - name: mediawiki/extensions/SkinPerPage
    template:
      - name: extension-checks
        extname: SkinPerPage

  - name: mediawiki/extensions/skins
    template:
      - name: extension-checks
        extname: skins

  - name: mediawiki/extensions/SlippyMap
    template:
      - name: extension-unittests
        extname: SlippyMap

  - name: mediawiki/extensions/Solarium
    template:
      - name: extension-checks
        extname: Solarium

  - name: mediawiki/extensions/SpamBlacklist
    template:
      - name: extension-checks
        extname: SpamBlacklist

  - name: mediawiki/extensions/StrategyWiki
    template:
      - name: extension-checks
        extname: StrategyWiki

  - name: mediawiki/extensions/SubPageList3
    template:
      - name: extension-checks
        extname: SubPageList3

  - name: mediawiki/extensions/SubpageSortkey
    template:
      - name: extension-checks
        extname: SubpageSortkey

  - name: mediawiki/extensions/Sudo
    template:
      - name: extension-checks
        extname: Sudo

  - name: mediawiki/extensions/Survey
    template:
      - name: extension-unittests
        extname: Survey

  - name: mediawiki/extensions/SVGEdit
    template:
      - name: extension-checks
        extname: SVGEdit

  - name: mediawiki/extensions/TemplateSandbox
    template:
      - name: extension-checks
        extname: TemplateSandbox

  - name: mediawiki/extensions/SyntaxHighlight_GeSHi
    check-only:
      - mwext-SyntaxHighlight_GeSHi-merge:
        - mwext-SyntaxHighlight_GeSHi-jslint
        - mwext-SyntaxHighlight_GeSHi-phpcs-HEAD
        - mwext-SyntaxHighlight_GeSHi-lint
    gate-and-submit:
      - mwext-SyntaxHighlight_GeSHi-merge:
        - mwext-SyntaxHighlight_GeSHi-jslint
        - mwext-SyntaxHighlight_GeSHi-phpcs-HEAD
        - mwext-SyntaxHighlight_GeSHi-lint

  - name: mediawiki/extensions/TemplateData
    check:
      - mwext-TemplateData-phpcs-HEAD
      - mwext-TemplateData-lint
    test:
      - mwext-TemplateData-phpcs-HEAD
      - mwext-TemplateData-lint:
        - mwext-TemplateData-testextensions-master
    gate-and-submit:
      - mwext-TemplateData-phpcs-HEAD
      - mwext-TemplateData-lint:
        - mwext-TemplateData-testextensions-master

  - name: mediawiki/extensions/Thanks
    template:
      - name: extension-checks
        extname: Thanks

  - name: mediawiki/extensions/TimedMediaHandler
    check-only:
      - mwext-TimedMediaHandler-merge:
        - mwext-TimedMediaHandler-jslint
        - mwext-TimedMediaHandler-lint
    gate-and-submit:
      - mwext-TimedMediaHandler-merge:
        - mwext-TimedMediaHandler-jslint
        - mwext-TimedMediaHandler-lint
# FIXME Requires the MwEmbedSupport extension :(
#        - mwext-TimedMediaHandler-lint:
#          - mwext-TimedMediaHandler-testextensions-master

  - name: mediawiki/extensions/TitleBlacklist
    template:
      - name: extension-unittests
        extname: TitleBlacklist

  - name: mediawiki/extensions/TitleKey
    template:
      - name: extension-checks
        extname: TitleKey

  - name: mediawiki/extensions/TocTree
    template:
      - name: extension-checks
        extname: TocTree

  - name: mediawiki/extensions/TorBlock
    template:
      - name: extension-checks
        extname: TorBlock

  - name: mediawiki/extensions/Translate
    check-only:
      - mwext-Translate-merge:
        - mwext-Translate-jslint
        - mwext-Translate-phpcs-HEAD
        - mwext-Translate-lint
    test:
      - mwext-Translate-merge:
        - mwext-Translate-jslint
        - mwext-Translate-phpcs-HEAD
        - mwext-Translate-lint:
          - mwext-Translate-testextensions-master
    gate-and-submit:
      - mwext-Translate-merge:
        - mwext-Translate-jslint
        - mwext-Translate-phpcs-HEAD
        - mwext-Translate-lint:
          - mwext-Translate-testextensions-master

  - name: mediawiki/extensions/TranslationNotifications
    check-only:
      - mwext-TranslationNotifications-merge:
        - mwext-TranslationNotifications-jslint
        - mwext-TranslationNotifications-phpcs-HEAD
        - mwext-TranslationNotifications-lint
    test:
      - mwext-TranslationNotifications-merge:
        - mwext-TranslationNotifications-jslint
        - mwext-TranslationNotifications-phpcs-HEAD
        - mwext-TranslationNotifications-lint:
          - mwext-TranslationNotifications-testextensions-master
    gate-and-submit:
      - mwext-TranslationNotifications-merge:
        - mwext-TranslationNotifications-jslint
        - mwext-TranslationNotifications-phpcs-HEAD
        - mwext-TranslationNotifications-lint:
          - mwext-TranslationNotifications-testextensions-master

  - name: mediawiki/extensions/Transliterator
    template:
      - name: extension-unittests
        extname: Transliterator

  - name: mediawiki/extensions/TrustedXFF
    template:
      - name: extension-checks
        extname: TrustedXFF

  - name: mediawiki/extensions/TwnMainPage
    check-only:
      - mwext-TwnMainPage-merge:
        - mwext-TwnMainPage-jslint
        - mwext-TwnMainPage-phpcs-HEAD
        - mwext-TwnMainPage-lint
    gate-and-submit:
      - mwext-TwnMainPage-merge:
        - mwext-TwnMainPage-jslint
        - mwext-TwnMainPage-phpcs-HEAD
        - mwext-TwnMainPage-lint

  - name: mediawiki/extensions/UnicodeConverter
    template:
      - name: extension-checks
        extname: UnicodeConverter

  - name: mediawiki/extensions/UniversalLanguageSelector
    check-only:
      - mwext-UniversalLanguageSelector-merge:
        - mwext-UniversalLanguageSelector-lint
        - mwext-UniversalLanguageSelector-phpcs-HEAD
        - mwext-UniversalLanguageSelector-jslint
    gate-and-submit:
      - mwext-UniversalLanguageSelector-merge:
        - mwext-UniversalLanguageSelector-jslint
        - mwext-UniversalLanguageSelector-phpcs-HEAD
        - mwext-UniversalLanguageSelector-lint:
          - mwext-UniversalLanguageSelector-testextensions-master

  - name: mediawiki/extensions/UploadBlacklist
    template:
      - name: extension-checks
        extname: UploadBlacklist

  - name: mediawiki/extensions/UploadWizard
    check:
      - mwext-UploadWizard-merge:
        - mwext-UploadWizard-jslint
        - mwext-UploadWizard-phpcs-HEAD
        - mwext-UploadWizard-lint
    test:
      - mwext-UploadWizard-merge:
        - mwext-UploadWizard-jslint
        - mwext-UploadWizard-phpcs-HEAD
        - mwext-UploadWizard-lint
    gate-and-submit:
      - mwext-UploadWizard-merge:
        - mwext-UploadWizard-jslint
        - mwext-UploadWizard-phpcs-HEAD
        - mwext-UploadWizard-lint

  - name: mediawiki/extensions/UserDailyContribs
    template:
      - name: extension-checks
        extname: UserDailyContribs

  - name: mediawiki/extensions/UserMerge
    template:
      - name: extension-checks
        extname: UserMerge

  - name: mediawiki/extensions/UserOptionStats
    template:
      - name: extension-checks
        extname: UserOptionStats

  - name: mediawiki/extensions/UserThrottle
    template:
      - name: extension-checks
        extname: UserThrottle

  - name: mediawiki/extensions/Validator
    template:
      - name: extension-unittests
        extname: Validator

  - name: mediawiki/extensions/Variables
    template:
      - name: extension-unittests
        extname: Variables

  - name: mediawiki/extensions/Vector
    check-only:
      - mwext-Vector-merge:
        - mwext-Vector-jslint
        - mwext-Vector-phpcs-HEAD
        - mwext-Vector-lint
    gate-and-submit:
      - mwext-Vector-merge:
        - mwext-Vector-jslint
        - mwext-Vector-phpcs-HEAD
        - mwext-Vector-lint

  - name: mediawiki/extensions/VipsScaler
    template:
      - name: extension-checks
        extname: VipsScaler

  - name: mediawiki/extensions/VisualEditor
    check:
      - mwext-VisualEditor-merge:
        - mwext-VisualEditor-jslint
        - mwext-VisualEditor-phpcs-HEAD
        - mwext-VisualEditor-lint
    test:
      - mwext-VisualEditor-merge:
        - mwext-VisualEditor-jslint
        - mwext-VisualEditor-phpcs-HEAD
        - mwext-VisualEditor-lint
        - mwext-VisualEditor-doc-test
        - mwext-VisualEditor-qunit
    gate-and-submit:
      - mwext-VisualEditor-merge:
        - mwext-VisualEditor-jslint
        - mwext-VisualEditor-phpcs-HEAD
        - mwext-VisualEditor-lint
        - mwext-VisualEditor-doc-test
        - mwext-VisualEditor-qunit
    postmerge:
      - mwext-VisualEditor-doc-publish

  - name: mediawiki/extensions/WebChat
    template:
      - name: extension-checks
        extname: WebChat

  - name: mediawiki/extensions/WebFonts
    check-only:
      - mwext-WebFonts-merge:
        - mwext-WebFonts-jslint
        - mwext-WebFonts-phpcs-HEAD
        - mwext-WebFonts-lint
    gate-and-submit:
      - mwext-WebFonts-merge:
        - mwext-WebFonts-jslint
        - mwext-WebFonts-phpcs-HEAD
        - mwext-WebFonts-lint

  - name: mediawiki/extensions/WikiEditor
    check-only:
      - mwext-WikiEditor-merge:
        - mwext-WikiEditor-jslint
        - mwext-WikiEditor-phpcs-HEAD
        - mwext-WikiEditor-lint
    gate-and-submit:
      - mwext-WikiEditor-merge:
        - mwext-WikiEditor-jslint
        - mwext-WikiEditor-phpcs-HEAD
        - mwext-WikiEditor-lint

  - name: mediawiki/extensions/Wikibase
    check:
      - mwext-Wikibase-merge:
        - mwext-Wikibase-jslint
        - mwext-Wikibase-lint
    test:
      - mwext-Wikibase-merge:
        - mwext-Wikibase-jslint
        - mwext-Wikibase-lint:
          - mwext-Wikibase-testextensions-master
          - mwext-Wikibase-client-tests
          - mwext-Wikibase-repo-tests
    gate-and-submit:
      - mwext-Wikibase-merge:
        - mwext-Wikibase-jslint
        - mwext-Wikibase-lint:
#          - mwext-Wikibase-client-tests
          - mwext-Wikibase-repo-tests

  - name: mediawiki/extensions/WikibaseDatabase
    template:
      - name: extension-unittests
        extname: WikibaseDatabase

  - name: mediawiki/extensions/WikibaseDataModel
    template:
      - name: extension-unittests
        extname: WikibaseDataModel

  - name: mediawiki/extensions/WikibaseQueryEngine
    template:
      - name: extension-unittests
        extname: WikibaseQueryEngine

  - name: mediawiki/extensions/WikiLove
    template:
      - name: extension-checks
        extname: WikiLove

  - name: mediawiki/extensions/wikihiero
    template:
      - name: extension-unittests
        extname: wikihiero

  - name: mediawiki/extensions/WikimediaIncubator
    template:
      - name: extension-checks
        extname: WikimediaIncubator

  - name: mediawiki/extensions/WikimediaMaintenance
    template:
      - name: extension-checks
        extname: WikimediaMaintenance

  - name: mediawiki/extensions/WikimediaMessages
    template:
      - name: extension-checks
        extname: WikimediaMessages

  - name: mediawiki/extensions/WikimediaShopLink
    template:
      - name: extension-checks
        extname: WikimediaShopLink

  - name: mediawiki/extensions/ZeroRatedMobileAccess
    template:
      - name: extension-checks
        extname: ZeroRatedMobileAccess

#### PHP Extensions ###################################################

  - name: mediawiki/php/FastStringSearch
    # no check pipeline since -build runs code :-)
    test:
      - php-FastStringSearch-build
    gate-and-submit:
      - php-FastStringSearch-build

  - name: mediawiki/php/luasandbox
    # no check pipeline since -build runs code :-)
    test:
      - php-luasandbox-build
    gate-and-submit:
      - php-luasandbox-build

  - name: mediawiki/php/NativePreprocessor
    # no check pipeline since -build runs code :-)
    test:
      - php-NativePreprocessor-build
    gate-and-submit:
      - php-NativePreprocessor-build

  - name: mediawiki/php/wikidiff
    # no check pipeline since -build runs code :-)
    test:
      - php-wikidiff-build
    gate-and-submit:
      - php-wikidiff-build

  - name: mediawiki/php/wikidiff2
    # no check pipeline since -build runs code :-)
    test:
      - php-wikidiff2-build
    gate-and-submit:
      - php-wikidiff2-build

  - name: mediawiki/php/wmerrors
    # no check pipeline since -build runs code :-)
    test:
      - php-wmerrors-build
    gate-and-submit:
      - php-wmerrors-build

  - name: pywikibot/compat
    template:
      - name: 'python-lint'
        prefix: 'pywikibot-compat'

  - name: pywikibot/core
    template:
      - name: 'python-lint'
        prefix: 'pywikibot-compat'

  - name: pywikibot/i18n
    template:
      - name: 'python-lint'
        prefix: 'pywikibot-compat'

  - name: qa/browsertests
    check-voter:
      - qa-browsertests-ruby1.9.3lint

  - name: sartoris
    template:
      - name: 'python-lint'
        prefix: 'sartoris'

  - name: test/mediawiki
    check-only:
      - test-mediawiki-dumpenv
      - test-mediawiki-phpcs-HEAD
      - test-mediawiki-qunit
    test:
      - test-mediawiki-dumpenv
      - test-mediawiki-phpcs-HEAD
      - test-mediawiki-qunit
    postmerge:
      - test-mediawiki-docgen
