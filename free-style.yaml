- job:
    name: free-style
    disabled: true

    scm:
      - git:
          url: https://gerrit.wikimedia.org/r/qa/browsertests
          branches:
            - master

    builders:
      - shell: |
          # gerrit

          # phantomjs

          curl -s -o use-node https://repository-cloudbees.forge.cloudbees.com/distributions/ci-addons/node/use-node
          NODE_VERSION=0.11.8 . ./use-node
          rm $HOME/bin/phantomjs
          npm install phantomjs
          ln -fs $WORKSPACE/node_modules/phantomjs/lib/phantom/bin/phantomjs $HOME/bin/phantomjs
          phantomjs -v

          # env
          export MEDIAWIKI_USER=Selenium_user
          export MEDIAWIKI_PASSWORD_VARIABLE=MEDIAWIKI_PASSWORD_SELENIUM_USER_WMFLABS_ORG

          export BROWSER_LABEL=phantomjs
          export MEDIAWIKI_URL=http://commons.wikimedia.beta.wmflabs.org/wiki/

          # ruby
          curl -s -o use-ruby https://repository-cloudbees.forge.cloudbees.com/distributions/ci-addons/ruby/use-ruby
          RUBY_VERSION=2.1.0 \
            source ./use-ruby

          gem install bundler --no-ri --no-rdoc
          cd tests/browser
          bundle install
          bundle exec cucumber --backtrace --verbose --format pretty --format Cucumber::Formatter::Sauce --out reports/junit features/login.feature:18

    publishers:
      - junit:
          results: tests/browser/reports/junit/*.xml
