# jshint is in a separate job from phplint because various extensions
# don't pass jshint yet but do pass phplint. This way we can opt-in
# on a project base.
- job-template:
    name: '{name}-{ext-name}-jslint'
    node: hasSlaveScripts
    defaults: use-remote-zuul-no-submodules
    concurrent: true
    triggers:
     - zuul
    builders:
     - jshint
     - jsonlint

- job-template:
    name: '{name}-{ext-name}-csslint'
    node: hasSlaveScripts
    defaults: use-remote-zuul-no-submodules
    concurrent: true
    triggers:
     - zuul
    builders:
     - csslint

- job-template:
    name: '{name}-{ext-name}-npm'
    node: contintLabsSlave
    defaults: use-remoteonly-zuul
    concurrent: true
    triggers:
     - zuul
    builders:
     - npm

- job-template:
    name: '{name}-{ext-name}-phplint'
    node: hasSlaveScripts
    defaults: use-remote-zuul-no-submodules
    concurrent: true
    triggers:
     - zuul
    builders:
     - phplint

# Compatibility: Use '{name}-{ext-name}-phplint' instead
- job-template:
    name: '{name}-{ext-name}-lint'
    node: hasSlaveScripts
    defaults: use-remote-zuul-no-submodules
    concurrent: true
    triggers:
     - zuul
    builders:
     - phplint

# Template to run browsertests for an extension
# Parameters: dependencies
#
- job-template:
    name: '{name}-{ext-name}-{browser}'
    node: contintLabsSlave
    defaults: use-zuul-for-mw-ext
    triggers:
     - zuul

    builders:
     # setup mediawiki master + extension dependencies
     - mw-setup-extension:
        mwbranch: 'master'
        dependencies: '{dependencies}'

     - browsertests:
         tests-path: 'extensions/{ext-name}/tests/browser'
         browser: '{browser}'

    publishers:
     - xunit:
         types:
          - junit:
              pattern: 'log/*.xml'
     - archive:
         artifacts: 'log/*.log, log/report.html, log/*.png'

- job-template:
    name: '{name}-{ext-name}-phpcs-HEAD'
    node: hasSlaveScripts
    defaults: use-remote-zuul
    concurrent: true
    triggers:
     - zuul
    builders:
     - phpcs-HEAD
    publishers:
     - phpcs

- job-template:
    name: '{name}-{ext-name}-qunit'
    node: gallium  # it has the qunit virtual host
    defaults: use-zuul-for-mw-ext
    concurrent: true
    triggers:
     - zuul

    builders:
     - mw-setup-extension:
        mwbranch: 'master'
        dependencies: '{dependencies}'
     - qunit
    publishers:
     - archive-log-dir

- job-template:
    name: '{name}-{ext-name}-qunit-mobile'
    node: gallium  # it has the qunit virtual host
    defaults: use-zuul-for-mw-ext
    concurrent: true
    triggers:
     - zuul

    builders:
     - mw-setup-extension:
        mwbranch: 'master'
        dependencies: '{dependencies}'
     - qunit-mobile
    publishers:
     - archive-log-dir

# Run all extension tests
- job-template:
    name: '{name}-{ext-name}-testextensions-{mwbranch}'
    node: hasSlaveScripts
    defaults: use-zuul-for-mw-ext
    triggers:
     - zuul
    builders:
     - mw-setup-extension:
        mwbranch: '{mwbranch}'
        dependencies: '{dependencies}'
     - mw-run-phpunit-allexts
    # TODO, find ways to additionaly run tests for core but
    # without extensions tests
    publishers:
     - archive-log-dir
     - junit:
        results: 'log/junit*.xml'

- job-template:
    name: 'mwext-GuidedTour-doc-test'
    defaults: use-remote-zuul
    concurrent: true
    triggers:
     - zuul
    builders:
     - jsduck-conf:
        config: '$WORKSPACE/.docs/config.json'

- job-template:
    name: 'mwext-GuidedTour-doc-publish'
    node: gallium
    defaults: use-remote-zuul
    triggers:
     - zuul
    builders:
     - jsduck-conf:
        config: '$WORKSPACE/.docs/config.json'
     - shell: |
        # Set destination and version directory therein
        DEST_DIR="/srv/org/wikimedia/doc/GuidedTour"
        DEST_VERSIONDIR=`echo "$ZUUL_BRANCH" | tr '/' '-'`
        # Ensure the destination exists
        mkdir -p $DEST_DIR
        # Publish it (trailing slash is important!)
        rsync --recursive --delete-after --force $WORKSPACE/docs/ "$DEST_DIR/$DEST_VERSIONDIR/"

- job-template:
    name: 'mwext-PoolCounter-build'
    defaults: use-remote-zuul
    triggers:
     - zuul
    builders:
     - shell: |
        cd daemon
        make

- job-template:
    name: 'mwext-MultimediaViewer-doc-publish'
    node: gallium
    defaults: use-remote-zuul
    triggers:
     - zuul
    builders:
     - shell: |
        # Generate documentation
        $WORKSPACE/docs/generate
        # Set destination and version directory therein
        DEST_DIR="/srv/org/wikimedia/doc/MultimediaViewer"
        DEST_VERSIONDIR=`echo "$ZUUL_BRANCH" | tr '/' '-'`
        # Ensure the destination exists
        mkdir -p $DEST_DIR
        # Publish it (trailing slash is important!)
        rsync --recursive --delete-after --force $WORKSPACE/docs/js/ "$DEST_DIR/$DEST_VERSIONDIR/"

- job-template:
    name: 'mwext-VisualEditor-doc-publish'
    node: gallium
    defaults: use-remote-zuul
    triggers:
     - zuul
    builders:
     - shell: |
        # Generate documentation
        $WORKSPACE/bin/generateDocs.sh
        # Set destination and version directory therein
        DEST_DIR="/srv/org/wikimedia/doc/VisualEditor"
        DEST_VERSIONDIR=`echo "$ZUUL_BRANCH" | tr '/' '-'`
        # Ensure the destination exists
        mkdir -p $DEST_DIR
        # Publish it (trailing slash is important!)
        rsync --recursive --delete-after --force $WORKSPACE/docs/ "$DEST_DIR/$DEST_VERSIONDIR/"
        rsync --recursive --delete-after --force $WORKSPACE/lib/ "$DEST_DIR/$DEST_VERSIONDIR/lib/"

- job-template:
    name: 'mwext-MultimediaViewer-doc-test'
    defaults: use-remote-zuul
    concurrent: true
    triggers:
     - zuul
    builders:
     - shell: |
        export TERM=xterm
        $WORKSPACE/docs/generate

- job-template:
    name: 'mwext-VisualEditor-doc-test'
    defaults: use-remote-zuul
    concurrent: true
    triggers:
     - zuul
    builders:
     - shell: |
        export TERM=xterm
        $WORKSPACE/bin/generateDocs.sh

- job-template:
    name: 'mwext-VisualEditor-sync-gerrit'  # bug 49846
    node: gallium  # needs 'jenkins' user which has the 'jenkins-bot' SSH credentials
    concurrent: false
    triggers:
     - zuul
    builders:
     - shell: /srv/deployment/integration/slave-scripts/bin/gerrit-sync-ve.sh
     - shell: sudo -u jenkins /srv/deployment/integration/slave-scripts/bin/gerrit-sync-ve-push.sh

# Job specific to Wikibase, let us switch between client
# and server configurations.
- job-template:
    name: 'mwext-Wikibase-{kind}-tests'
    node: hasSlaveScripts
    defaults: use-zuul-for-mw-ext
    ext-name: 'Wikibase'
    triggers:
     - zuul
    builders:
     - mw-setup-extension:
        mwbranch: 'master'
        dependencies: '{dependencies}'
     - mw-run-phpunit-allexts
    publishers:
     - archive-log-dir
     - junit:
        results: 'log/junit*.xml'

# These are jobs we create for all of the extensions
# listed below. If a job should only be created
# for a select number of extensions or if it needs
# custom parameters, add it below under "Extra jobs for specific extensions"
# at the bottom of this file.
- job-group:
    name: mwext-check-jobs
    jobs:
     - '{name}-{ext-name}-lint'
     - '{name}-{ext-name}-jslint'
     - '{name}-{ext-name}-testextensions-{mwbranch}'
     - '{name}-{ext-name}-phpcs-HEAD'

- project:
    name: mwext

    # By default we do not need any other extensions:
    dependencies: ""

    ext-name:
     - AbsenteeLandlord
     - AbuseFilter
     - AccessControl
     - AccountAudit
     - AccountInfo
     - ActionEditSubmit
     - ActiveAbstract
     - ActivityMonitor
     - AddMessages
     - AddMetaAndTitle
     - AddThis
     - AdManager
     - AdminLinks
     - Ads
     - AdvancedMeta
     - Agora
     - AjaxLogin
     - AJAXPoll
     - AkismetKlik
     - AllTimeZones
     - AmazonLookup
     - AnchorHandler
     - Annotator
     - AntiBot
     - AntiSpoof
     - APC
     - ApiExplorer
     - ApiSandbox
     - ApiSVGProxy
     - ApprovedRevs
     - Arrays
     - ArticleCreationWorkflow
     - ArticleFeedback
     - ArticleFeedbackv5
     - ArticleIndex
     - ArticleRatings
     - AssertEdit
     - AuthorProtect
     - Auth_remoteuser
     - AutoCreateCategoryPages
     - AutomaticBoardWelcome
     - AutoProxyBlock
     - Awesomeness
     - AWS
     - AWSSDK
     - AzharAuth
     - Babel
     - BatchUserRights
     - BayesianFilter
     - BetaFeatures
     - BiblioPlus
     - BibManager
     - Blackout
     - BlameMaps
     - BlockAndNuke
     - BlogPage
     - BlueSpiceExtensions
     - BlueSpiceFoundation
     - BookManager
     - BookManagerv2
     - Bootstrap
     - BounceHandler
     - BreadCrumbs
     - BreadCrumbs2
     - Calendar
     - Campaigns
     - Capiunto
     - Carp
     - CategoryMagicWords
     - CategorySlideShow
     - CategorySortHeaders
     - CategoryTagSorter
     - CategoryTests
     - CategoryTree
     - Censor
     - CentralAuth
     - CentralLogging
     - CentralNotice
     - CentralNotice
     - CharInsert
     - CharRangeSpan
     - Checkpoint
     - CheckUser
     - CirrusSearch
     - CirrusSearch
     - Cite
     - Citoid
     - cldr
     - CleanChanges
     - ClickTracking
     - ClientSide
     - CloseWikis
     - CodeEditor
     - CodeReview
     - Collection
     - Collection
     - Collection
     - Collection
     - Collection
     - Collection
     - Collection
     - Commentbox
     - CommentPages
     - Comments
     - CommonMessages
     - CommonsMetadata
     - CommunityApplications
     - CommunityHiring
     - CommunityTwitter
     - CommunityVoice
     - ConditionalShowSection
     - Configure
     - ConfirmAccount
     - ConfirmEdit
     - CongressLookup
     - ContactPage
     - ContactPageFundraiser
     - ContentTranslation
     - Contest
     - ContextComments
     - ContributionReporting
     - ContributionScores
     - ContributionTracking
     - Contributors
     - ConventionExtension
     - Convert2Wiki
     - CopyToClipboard
     - CreatePage
     - CreateRedirect
     - CreditsSource
     - CreditTab
     - CryoKey
     - CSS
     - CustomData
     - CustomMagic
     - CustomUserSignup
     - DataModel
     - DataTransfer
     - DataTypes
     - DataValueImplementations
     - DataValuesCommon
     - DataValuesInterfaces
     - DataValuesJavascript
     - DebianISOCodes
     - DeleteBatch
     - DeleteOwn
     - Description2
     - DeviceMapLogCapture
     - Diagnosis
     - Dice
     - DidYouKnow
     - DidYouMean
     - DisableAccount
     - Disambiguator
     - DiscussionThreading
     - DismissableSiteNotice
     - DisqusTag
     - DjangoAnalytics
     - DonationInterface
     - DoubleWiki
     - DownloadCounter
     - DPLforum
     - Drafts
     - DumpHTML
     - Duplicator
     - DynamicPageList
     - DynamicSidebar
     - E3Experiments
     - Echo
     - Editcount
     - EditPageTracking
     - EditSubpages
     - EducationProgram
     - EImage
     - Elastica
     - ELearnware
     - EmailCapture
     - EnhanceContactForm
     - ErrorHandler
     - EtherEditor
     - EtherpadLite
     - EventLogging
     - examples
     - ExpandTemplates
     - ExtensionDistributor
     - ExtensionStatus
     - ExternalArticles
     - ExternalData
     - ExtraLanguageLink
     - ExtTab
     - FacebookOpenGraph
     - FanBoxes
     - FeaturedFeeds
     - FeedsFromPrivateWikis
     - FilterListUsers
     - FirstSteps
     - FlaggedRevs
     - FlashPlayer
     - Flow
     - FlvHandler
     - ForcePreview
     - FormatDates
     - FormatNum
     - FormelApplet
     - FormPreloadPostCache
     - Foxway
     - FundraiserLandingPage
     - FundraisingChart
     - FundraisingEmailUnsubscribe
     - FundraisingTranslateWorkflow
     - Gadgets
     - Genderize
     - GeoCrumbs
     - GeoData
     - GeoGebra
     - GettingStarted
     - Git2Pages
     - Gitweb
     - GlobalBlocking
     - GlobalContributions
     - GlobalCssJs
     - GlobalNotice
     - GlobalPreferences
     - GlobalUsage
     - GlobalUserGroups
     - GlobalUserPage
     - GlobalUserrights
     - GoogleAdSense
     - googleAnalytics
     - GoogleAppEngine
     - GoogleCustomWikiSearch
     - GoogleDocs4MW
     - GoogleDocTag
     - GoogleLogin
     - GoogleMaps
     - GoogleNewsSitemap
     - GooglePlusOne
     - GoogleSiteSearch
     - GoogleTagManager
     - GraphViz
     - GroupsSidebar
     - GuidedTour
     - GuidedTour
     - GWToolset
     - HaloTripleStoreConnector
     - Hanp
     - HashTables
     - HeaderTabs
     - HelpCommons
     - HelpPages
     - HidePrefix
     - HostStats
     - HotCat
     - Hovergallery
     - HSTS
     - HTMLets
     - HTMLTags
     - I18nTags
     - IframePage
     - IfTemplates
     - ImageMap
     - ImportBibliography
     - IndexFunction
     - InlineCategorizer
     - InputBox
     - Insider
     - InteractiveBlockMessage
     - Interlanguage
     - intersection
     - Interwiki
     - InterwikiExistence
     - InterwikiMagic
     - InterwikiMap
     - InviteSignup
     - Ipernity
     - Isbn
     - ISO3166
     - ISO639
     - IssueTracker
     - Josa
     - JSBreadCrumbs
     - JsonConfig
     - JsonData
     - JsonData
     - LabeledSectionTransclusion
     - LandingCheck
     - LanguageSelector
     - LanguageTag
     - LastModified
     - LdapAuthentication
     - Less
     - LifeWeb
     - LifeWebCore
     - LightboxGallery
     - LightweightRDFa
     - Limn
     - Lingo
     - LinkedWiki
     - LinkFilter
     - LinkSuggest
     - LiquidThreads
     - Listings
     - ListTransclusions
     - LiveTranslate
     - LocalisationUpdate
     - Lockdown
     - LockDownEnglishPages
     - LogEntry
     - LogoFunctions
     - LookupUser
     - LoopFunctions
     - Loops
     - MagicNoCache
     - MailChimpSubscription
     - Maintenance
     - MaintenanceShell
     - Mantle
     - Maps
     - MapSources
     - MarkAsHelpful
     - MassEditRegex
     - MassMessage
     - Math
     - MathSearch
     - MediaFunctions
     - MediaWikiAuth
     - MediaWikiChat
     - Memento
     - MetaDescriptionTag
     - Minifier
     - MirrorTools
     - MixedNamespaceSearchSuggestions
     - MobileApp
     - MobileFrontend
     - MobileSections
     - Model
     - MolHandler
     - MoodBar
     - Moodle
     - Mpdf
     - MsLinks
     - MSSQLBackCompat
     - MsUpload
     - MultiAudioVideo
     - MultiMaps
     - MultimediaViewer
     - MultiUpload
     - MwEmbedSupport
     - MWSearch
     - MyVariables
     - NamespacePaths
     - NamespaceRelations
     - Narayam
     - NaturalLanguageList
     - NavigationTiming
     - Negref
     - NetworkAuth
     - NewestPages
     - News
     - NewSignupPage
     - Newsletter
     - NewUserMessage
     - NewUserNotif
     - NewUsersList
     - Nonlinear
     - normal
     - Nostalgia
     - NoTitle
     - NoUnwrap
     - NSFileRepo
     - Nuke
     - NukeDPL
     - NumberFormat
     - NumberOfWikis
     - Numbertext
     - NumerAlpha
     - OAI
     - OATHAuth
     - OAuth
     - OdbcDatabase
     - Offline
     - OfflineImportLexicon
     - OggHandler
     - OnlineStatus
     - OnlineStatusBar
     - OnlyRecentRecentChanges
     - OpenBadges
     - OpenGraphMeta
     - OpenID
     - OpenSearchXml
     - OpenStackManager
     - OpenStreetMapSlippyMap
     - OracleTextSearch
     - Oversight
     - PageBlock
     - PageCreationNotif
     - PageCredits
     - PageDisqus
     - PagedTiffHandler
     - PageImages
     - PageInCat
     - PageLanguage
     - PageNotice
     - PageSchemas
     - PageTools
     - PageTriage
     - PanScroll
     - ParserFun
     - ParserFunctions
     - ParserHooks
     - Parsoid
     - Parsoid
     - Parsoid
     - Parsoid
     - PartitionQuery
     - PDBHandler
     - PdfBook
     - PdfExport
     - PdfHandler
     - PerformanceMonitor
     - PerPageLicense
     - Persona
     - Petition
     - PGFTikZ
     - Phalanx
     - PHPExcel
     - PhpHighlight
     - PhpTags
     - PhpTagsCodeEditor
     - PhpTagsDebugger
     - PhpTagsFunctions
     - PhpTagsMaps
     - PhpTagsWidgets
     - PhpTagsWiki
     - PictureGame
     - PlaceNewSection
     - Poem
     - Poll
     - PollNY
     - Polyglot
     - PoolCounter
     - PopupPages
     - Popups
     - PostEdit
     - PrefixExport
     - PrefStats
     - PrefSwitch
     - Premoderation
     - PrivateDomains
     - PronunciationRecording
     - ProofreadPage
     - PropertySuggester
     - ProtectedTitles
     - ProtectSite
     - ProxyListDb
     - PubSubHubbub
     - PubSubHubbubSubscriber
     - PurgeClickThrough
     - PurposeCentricSearch
     - Push
     - PushToWatch
     - Quantcast
     - QueryResult
     - QuickResponse
     - Quiz
     - QuizGame
     - QuizTabulate
     - RandomFeaturedUser
     - RandomGameUnit
     - RandomImage
     - RandomImageByCategory
     - RandomInCategory
     - RandomRootPage
     - RandomUsersWithAvatars
     - Ratings
     - RDFIO
     - ReaderFeedback
     - RealNames
     - ReassignEdits
     - RefreshSpecial
     - RegexFun
     - RegexFunctions
     - RelatedArticles
     - RelatedSites
     - RelationLinks
     - Renameuser
     - ReorderParserPhases
     - ReplaceSet
     - ReplaceText
     - RevisionCommentSupplement
     - RightFunctions
     - RSS
     - RT
     - Sarcasm
     - ScanSet
     - Score
     - Scribunto
     - SearchExtraNS
     - SearchRealnames
     - SectionDisqus
     - SecureHTML
     - SecurePasswords
     - SecurePoll
     - SecureSessions
     - SelectCategory
     - SelectTag
     - SemanticACL
     - SemanticBundle
     - SemanticComments
     - SemanticCompoundQueries
     - SemanticDrilldown
     - SemanticDummyEditor
     - SemanticExpressiveness
     - SemanticExtraSpecialProperties
     - SemanticForms
     - SemanticFormsDisplayTitle
     - SemanticFormsInputs
     - SemanticFormsUniqueValue
     - SemanticGenealogy
     - SemanticGlossary
     - SemanticHighcharts
     - SemanticImageAnnotator
     - SemanticImageInput
     - SemanticInternalObjects
     - SemanticMaps
     - SemanticMediaWiki
     - SemanticPageMaker
     - SemanticPageSeries
     - SemanticRating
     - SemanticResultFormats
     - SemanticSifter
     - SemanticSignup
     - SemanticTasks
     - SemanticTitle
     - SemanticUpdateOnPurge
     - SemanticWatchlist
     - SemanticWebBrowser
     - SharedCssJs
     - ShareThisWidget
     - ShortUrl
     - ShortUrlApi
     - ShoutBox
     - ShoutWikiAds
     - ShrinkTheWeb
     - SidebarDonateBox
     - SideBarMenu
     - SignupAPI
     - SignWritingMediaWikiPlugin
     - SimpleAntiSpam
     - SimpleChanges
     - SimpleFarm
     - SimpleSamlAuth
     - SimpleSecurity
     - SimpleSurvey
     - SiteMatrix
     - SiteMetrics
     - SiteSettings
     - SkelJS
     - SkinPerNamespace
     - SkinPerPage
     - skins
     - SlimboxThumbs
     - SmoothGallery
     - SMWHalo
     - SocialLogin
     - SocialProfile
     - SoftwareVersion
     - Solarium
     - SOLRSearch
     - SolrStore
     - SoundManager2Button
     - SpamBlacklist
     - Spark
     - Special404
     - SpecialNamespaces
     - SpellingApi
     - SphinxSearch
     - SportsTeams
     - Spreadsheet
     - SSLClientAuthentication
     - StalkerLog
     - StarterWiki
     - StickToThatLanguage
     - StopForumSpam
     - StoryParagraph
     - StrategyWiki
     - StringFunctionsEscaped
     - SubpageFun
     - SubPageList
     - SubPageList3
     - SubpageSortkey
     - SubpageWatchlist
     - Sudo
     - Suhosin
     - Survey
     - SVGEdit
     - SwarmExport
     - SwedishCollation
     - SwiftCloudFiles
     - SyntaxHighlighter
     - SyntaxHighlight_GeSHi
     - Tabber
     - Tabs
     - TemplateData
     - TemplateDocumentation
     - TemplateInfo
     - TemplateSandbox
     - TextExtracts
     - Thanks
     - Theme
     - ThemeDesigner
     - ThrottleOverride
     - ThumbParser
     - TimedMediaHandler
     - timeline
     - TimelineTable
     - TimeMachine
     - TimezoneSelector
     - TitleBlacklist
     - TitleIcon
     - TitleKey
     - TocTree
     - TorBlock
     - Translate
     - TranslateSvg
     - TranslationNotifications
     - Transliterator
     - TrustedXFF
     - TweetANew
     - TwitterCards
     - TwnMainPage
     - TwoFactorAuthentication
     - UIFeedback
     - UnicodeConverter
     - UnitTest
     - UniversalLanguageSelector
     - UpdateMediaWiki
     - UploadBlacklist
     - UploadLocal
     - UploadWizard
     - UrlGetParameters
     - URNames
     - UserDailyContribs
     - UserFunctions
     - UserMerge
     - UserOptionStats
     - UserPageViewTracker
     - UserSnoop
     - UserStatus
     - UserThrottle
     - Validator
     - ValueView
     - Variables
     - Vector
     - VectorBeta
     - VersionView
     - Video
     - VideoJsPlayer
     - ViewFiles
     - Views
     - VipsScaler
     - VisualChat
     - VisualEditor
     - VisualWiki
     - VoteNY
     - WantedPagesFromNS
     - WatchSubpages
     - WebCache
     - WebChat
     - WebFonts
     - WebPlatformAuth
     - WebPlatformSearchAutocomplete
     - WhichImageIsBetter
     - WhitelistPages
     - WhiteSpace
     - WhoIsWatching
     - Widgets
     - WikiArticleFeeds
     - Wikibase
     - Wikibase
     - WikibaseClient
     - WikibaseLib
     - WikibaseMobile
     - WikibaseQuery
     - WikibaseRepo
     - WikibaseSolr
     - WikiCategoryTagCloud
     - WikiCortex
     - Wikidata
     - WikidataEntitySuggester
     - WikiEditor
     - WikiFarm
     - WikiForum
     - wikihiero
     - WikiLexicalData
     - Wikilog
     - WikiLove
     - WikiLovesMonuments
     - WikimediaEvents
     - WikimediaIncubator
     - WikimediaMaintenance
     - WikimediaMessages
     - WikimediaShopLink
     - WikiObjectModel
     - WikiShare
     - WikiTextLoggedInOut
     - WikiTwidget
     - WikivoteMapsYandex
     - WikivotePageSchemas
     - WikivoyageMessages
     - WindowsAzureSDK
     - WindowsAzureStorage
     - Workflow
     - WYSIWYG
     - YetAnotherKeywords
     - YotpoReviews
     - YouTube
     - ZeroBanner
     - ZeroPortal
     - ZeroRatedMobileAccess

    mwbranch:
     - master
# Commented out since they are not triggered for now.
#     - REL1_23
#     - REL1_22
#     - REL1_21
#     - REL1_20
#     - REL1_19

    jobs:
     - mwext-check-jobs

    # Extra jobs for specific extensions

     - '{name}-{ext-name}-testextensions-{mwbranch}':
        name: mwext
        ext-name: Capiunto
        dependencies: 'Scribunto'
     - '{name}-{ext-name}-testextensions-{mwbranch}':
        name: mwext
        ext-name: CirrusSearch
        # Please also update browsertests dependencies
        dependencies: 'Cite,Elastica,MwEmbedSupport,TimedMediaHandler,PdfHandler'
     - '{name}-{ext-name}-testextensions-{mwbranch}':
        name: mwext
        ext-name: DataTypes
        dependencies: 'DataValues'
     - '{name}-{ext-name}-testextensions-{mwbranch}':
        name: mwext
        ext-name: DonationInterface
        dependencies: 'ContributionTracking'
     - '{name}-{ext-name}-testextensions-{mwbranch}':
        name: mwext
        ext-name: EducationProgram
        dependencies: 'cldr'
     - '{name}-{ext-name}-testextensions-{mwbranch}':
        name: mwext
        ext-name: FlaggedRevs
        dependencies: 'Scribunto'
     - '{name}-{ext-name}-testextensions-{mwbranch}':
        name: mwext
        ext-name: Flow
        dependencies: 'AbuseFilter,SpamBlacklist,CheckUser,Mantle,Echo'
     - '{name}-{ext-name}-testextensions-{mwbranch}':
        name: mwext
        ext-name: GettingStarted
        dependencies: 'CentralAuth,EventLogging,GuidedTour'
     - '{name}-{ext-name}-testextensions-{mwbranch}':
        name: mwext
        ext-name: GuidedTour
        dependencies: 'EventLogging'
     - '{name}-{ext-name}-testextensions-{mwbranch}':
        name: mwext
        ext-name: MobileFrontend
        dependencies: 'Mantle'
     - '{name}-{ext-name}-testextensions-{mwbranch}':
        name: mwext
        ext-name: NavigationTiming
        dependencies: 'EventLogging'
     - '{name}-{ext-name}-testextensions-{mwbranch}':
        name: mwext
        ext-name: MassMessage
        dependencies: 'LiquidThreads'
     - '{name}-{ext-name}-testextensions-{mwbranch}':
        name: mwext
        ext-name: PhpTagsFunctions
        dependencies: 'PhpTags'
     - '{name}-{ext-name}-testextensions-{mwbranch}':
        name: mwext
        ext-name: PhpTagsWiki
        dependencies: 'PhpTags'
     - '{name}-{ext-name}-testextensions-{mwbranch}':
        name: mwext
        ext-name: ProofreadPage
        dependencies: 'LabeledSectionTransclusion'
     - '{name}-{ext-name}-testextensions-{mwbranch}':
        name: mwext
        ext-name: Thanks
        dependencies: 'Echo,Flow,Mantle'
     - '{name}-{ext-name}-testextensions-{mwbranch}':
        name: mwext
        ext-name: TitleBlacklist
        dependencies: 'AntiSpoof'
     - '{name}-{ext-name}-testextensions-{mwbranch}':
        name: mwext
        ext-name: TimedMediaHandler
        dependencies: 'MwEmbedSupport'
     - '{name}-{ext-name}-testextensions-{mwbranch}':
        name: mwext
        ext-name: TranslationNotifications
        dependencies: 'Translate'
     - '{name}-{ext-name}-testextensions-{mwbranch}':
        name: mwext
        ext-name: Validator
        dependencies: 'DataValues'
     - '{name}-{ext-name}-testextensions-{mwbranch}':
        name: mwext
        ext-name: Wikibase
        dependencies: 'Diff,DataValues,DataTypes,WikibaseDataModel,Scribunto'
     - 'mwext-Wikibase-{kind}-tests':
        ext-name: Wikibase
        dependencies: 'Diff,DataValues,DataTypes,WikibaseDataModel,Scribunto'
        kind: 'client'
     - 'mwext-Wikibase-{kind}-tests':
        ext-name: Wikibase
        dependencies: 'Diff,DataValues,DataTypes,WikibaseDataModel'
        kind: 'repo'
     - 'mwext-Wikibase-{kind}-tests':
        ext-name: Wikibase
        dependencies: 'Diff,DataValues,DataTypes,WikibaseDataModel'
        kind: 'repoapi'
     - '{name}-{ext-name}-qunit':
        ext-name: Wikibase
        dependencies: 'Diff,DataValues,DataTypes,WikibaseDataModel,Scribunto'
     - '{name}-{ext-name}-testextensions-{mwbranch}':
        ext-name: WikibaseDataModel
        dependencies: 'Diff,DataValues'
     - '{name}-{ext-name}-testextensions-{mwbranch}':
        name: mwext
        ext-name: WikimediaEvents
        dependencies: 'EventLogging'
     - '{name}-{ext-name}-testextensions-{mwbranch}':
        ext-name: ZeroRatedMobileAccess
        dependencies: 'MobileFrontend,Mantle'
     - '{name}-{ext-name}-testextensions-{mwbranch}':
        ext-name: ZeroBanner
        dependencies: 'JsonConfig,MobileFrontend,Mantle'
     - '{name}-{ext-name}-testextensions-{mwbranch}':
        ext-name: ZeroPortal
        dependencies: 'JsonConfig,MobileFrontend,Mantle,ZeroBanner'

     # qunit jobs for MediaWiki extensions

     - '{name}-{ext-name}-qunit':
        name: mwext
        ext-name: DataValues
     - '{name}-{ext-name}-qunit':
        name: mwext
        ext-name: EventLogging
     - '{name}-{ext-name}-qunit':
        name: mwext
        ext-name: Flow
        dependencies: 'AbuseFilter,SpamBlacklist,CheckUser,Mantle,MobileFrontend'
     - '{name}-{ext-name}-qunit':
        name: mwext
        ext-name: GettingStarted
        dependencies: 'CentralAuth,EventLogging,GuidedTour'
     - '{name}-{ext-name}-qunit':
        name: mwext
        ext-name: GuidedTour
        dependencies: 'EventLogging'
     - '{name}-{ext-name}-qunit':
        name: mwext
        ext-name: Mantle
        dependencies: 'MobileFrontend'
     - '{name}-{ext-name}-qunit-mobile':
        name: mwext
        ext-name: Mantle
        dependencies: 'MobileFrontend'
     - '{name}-{ext-name}-qunit':
        name: mwext
        ext-name: MobileFrontend
        dependencies: Mantle
     - '{name}-{ext-name}-qunit-mobile':
        name: mwext
        ext-name: MobileFrontend
        dependencies: Mantle
     - '{name}-{ext-name}-qunit':
        name: mwext
        ext-name: MultimediaViewer
     - '{name}-{ext-name}-qunit':
        name: mwext
        ext-name: Popups
     - '{name}-{ext-name}-qunit':
        name: mwext
        ext-name: TemplateData
     - '{name}-{ext-name}-npm':
        name: mwext
        ext-name: TemplateData

     - '{name}-{ext-name}-qunit':
        name: mwext
        ext-name: UploadWizard

     - '{name}-{ext-name}-qunit':
        name: mwext
        ext-name: VisualEditor
        dependencies: 'Parsoid'
     - '{name}-{ext-name}-csslint':
        ext-name: VisualEditor
     - '{name}-{ext-name}-npm':
        ext-name: VisualEditor

       # Documentation jobs for extensions
     - 'mwext-GuidedTour-doc-test':
     - 'mwext-GuidedTour-doc-publish':

     - 'mwext-MultimediaViewer-doc-test':
     - 'mwext-MultimediaViewer-doc-publish':

     - 'mwext-VisualEditor-doc-test':
        ext-name: VisualEditor

     - 'mwext-VisualEditor-doc-publish':
        ext-name: VisualEditor

# browser tests for MediaWiki extensions
#
# One can find a list of all repositories on the mediawiki-selenium ruby gems
# page at https://github.com/wikimedia/mediawiki-selenium#links
#
# Some are commented out, pending testing / proper implementation.
#
- project:
    name: mwext-browsertests
    dependencies: ''
    browser:
     - firefox
     - phantomjs
     #- chromium  # Unsupported by Watir yet (bug 61262)
    ext-name:
     ##- CirrusSearch  # customized below
     #- ContentTranslation
     - Flow
     - MobileFrontend
     #- MultimediaViewer
     - Translatewiki
     #- Translate
     #- TwnMainPage
     - UniversalLanguageSelector
     - VisualEditor
     #- Wikibase
    jobs:
     - '{name}-{ext-name}-{browser}'
     - '{name}-{ext-name}-{browser}':
         name: mwext-browsertests
         ext-name: CirrusSearch
         browser: phantomjs
         # Please also update extensions unit tests above
         dependencies: 'Cite,Elastica,Mantle,MwEmbedSupport,TimedMediaHandler,PdfHandler'
     - '{name}-{ext-name}-{browser}':
         name: mwext-browsertests
         ext-name: Flow
         dependencies: 'AbuseFilter,SpamBlacklist,CheckUser'

- project:
    name: 'mwext-BlameMaps'
    jobs:
     - python-jobs

- project:
    name: 'mwext-cldr'
    jobs:
     - '{name}-phpcs-strict-HEAD'

- project:
    name: 'mwext-CirrusSearch'
    jobs:
     - '{name}-ruby1.9.3lint'

- project:
    name: mwext-Collection-OfflineContentGenerator
    jobs:
        - '{name}-jslint'
        - '{name}-npm'

- project:
    name: mwext-Collection-OfflineContentGenerator-bundler
    jobs:
        - '{name}-jslint'
        - '{name}-npm'

- project:
    name: mwext-Collection-OfflineContentGenerator-latex_renderer
    jobs:
        - '{name}-jslint'
        - '{name}-npm'

- project:
    name: mwext-Collection-OfflineContentGenerator-text_renderer
    jobs:
        - '{name}-jslint'
        - '{name}-npm'

- project:
    name: 'mwext-ConfirmEdit'
    jobs:
     - python-jobs

- project:
    name: 'mwext-ContentTranslation'
    jobs:
     - '{name}-phpcs-strict-HEAD'
     - '{name}-ruby1.9.3lint'
     - '{name}-yamllint'

- project:
    name: 'mwext-DumpHTML'
    jobs:
     - python-jobs

- project:
    name: 'mwext-EventLogging'
    toxenv:
     - flake8
     - py27
    jobs:
     - python-jobs
     - '{name}-tox-{toxenv}'

- project:
    name: 'mwext-Flow'
    jobs:
     - '{name}-ruby1.9.3lint'

- project:
    name: 'mwext-Interwiki'
    jobs:
     - '{name}-phpcs-strict-HEAD'

- project:
    name: 'mwext-LocalisationUpdate'
    jobs:
     - '{name}-phpcs-strict-HEAD'

- project:
    name: 'mwext-MobileFrontend'
    jobs:
     - '{name}-ruby1.9.3lint'

- project:
    name: 'mwext-Offline'
    jobs:
     - python-jobs

- project:
    name: 'mwext-OpenStackManager'
    jobs:
     - python-jobs

- project:
    name: 'mwext-PoolCounter'
    jobs:
     - 'mwext-PoolCounter-build'

- project:
    name: 'mwext-SemanticBundle'
    jobs:
     - python-jobs

- project:
    name: 'mwext-SemanticResultFormats'
    jobs:
     - python-jobs

- project:
    name: 'mwext-timeline'
    jobs:
     - '{name}-perllint'

- project:
    name: 'mwext-Translate'
    jobs:
     - '{name}-phpcs-strict-HEAD'
     - '{name}-phpcs-strict'
     - '{name}-ruby1.9.3lint'

- project:
    name: 'mwext-TranslationNotifications'
    jobs:
     - '{name}-phpcs-strict-HEAD'

- project:
    name: 'mwext-TwnMainPage'
    jobs:
     - '{name}-phpcs-strict-HEAD'
     - '{name}-ruby1.9.3lint'

- project:
    name: 'mwext-UniversalLanguageSelector'
    jobs:
     - '{name}-ruby1.9.3lint'
     - '{name}-phpcs-strict-HEAD'

- project:
    name: 'mwext-UploadWizard'
    jobs:
     - python-jobs

- project:
    name: 'mwext-VisualEditor'
    jobs:
     - '{name}-ruby1.9.3lint'
     - 'mwext-VisualEditor-sync-gerrit'

- project:
    name: 'mwext-WikimediaMaintenance'
    jobs:
     - python-jobs

- project:
    name: 'mwext-Workflow'
    jobs:
     - '{name}-yamllint'
