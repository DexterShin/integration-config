# Git macro that simply fetch under '/packaging/'
# Useful to build debian packages.
- scm:
    name: git-deb-package
    scm:
     - git:
        url: '/srv/ssd/zuul/git/$ZUUL_PROJECT'
        basedir: 'packaging'
        branches:
         - '$ZUUL_COMMIT'
        refspec: '$ZUUL_REF'

- job-template:
    name: '{name}-debbuild'
    node: gallium  # requires packages-builder
    defaults: use-zuul

    scm:
     - git-deb-package

    builders:
     - shell: 'cd packaging && uscan --verbose --rename --download-current-version'
     - shell: 'cd packaging && dpkg-buildpackage -rfakeroot -us -uc'
     - shell: 'lintian --info *.deb'

- job-template:
    name: '{name}-antbuild'
    defaults: use-zuul
    triggers:
     - zuul

    scm:
     - git-deb-package

    builders:
     - ant:
        targets: 'build'
        buildfile: '$WORKSPACE/packaging/build.xml'

- project:
    name: 'operations-debs-python-voluptuous'
    jobs:
     - '{name}-debbuild'

- project:
    name: 'operations-debs-adminbot'
    jobs:
     - python-jobs

- project:
    name: 'operations-debs-ircecho'
    jobs:
     - python-jobs

- project:
    name: 'lucene-search-2'
    jobs:
     - '{name}-antbuild'
